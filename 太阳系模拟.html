<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太阳系模拟</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000; /* 使用 #000 更标准 */
            font-family: Arial, sans-serif;
            color: white;
        }
        /* 添加一个容器 div 以更好地管理 canvas 和标签 */
        #simulation-container {
            position: relative;
            width: 100%;
            height: 100vh;
            touch-action: none; /* 防止默认触摸行为干扰我们的自定义缩放 */
        }
        canvas {
            display: block; /* 避免底部小间隙 */
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab; /* 当用户悬停在画布上时显示抓取光标 */
        }
        canvas.grabbing {
            cursor: grabbing; /* 拖动时改变光标 */
        }
        #info-panel { /* 重命名选择器以匹配 ID */
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 5px;
            max-width: 300px;
            max-height: calc(100vh - 20px); /* 调整最大高度 */
            overflow-y: auto;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 200;
        }
        /* 整个面板的关闭按钮 */
        #info-panel > .close-button {
            position: absolute;
            top: 5px; /* 调整位置 */
            right: 5px; /* 调整位置 */
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px; /* 稍大一点 */
            line-height: 1; /* 确保垂直居中 */
            padding: 5px; /* 增加点击区域 */
            z-index: 210;
        }
        h1, h2 {
            margin-top: 0;
            margin-bottom: 10px; /* 添加底部间距 */
        }
        .intro-content {
            position: relative;
            display: block;
        }
        .planet-info {
            display: none;
            position: relative;
        }
        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
            display: flex; /* 使用 flex 布局 */
            flex-wrap: wrap; /* 允许换行 */
            gap: 10px; /* 添加元素间距 */
            align-items: center; /* 垂直居中 */
        }
        button {
            background-color: #4CAF50; /* 使用 # 更标准 */
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
        }
        #info-toggle-btn {
            position: absolute;
            top: 10px;
            left: calc(10px + 250px); /* 示例：放在 controls 右侧 */
            z-index: 100; /* 与 controls 同级 */
        }
        #info-panel.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(20px);
        }
        .slider-container {
            display: flex;
            align-items: center;
        }
        .slider-container label {
            margin-right: 5px; /* 调整间距 */
            min-width: 40px; /* 调整宽度 */
            font-size: 14px; /* 统一字体大小 */
        }
        .slider-container input[type="range"] {
            width: 100px; /* 给滑块一个固定宽度 */
        }
        .slider-container span {
            margin-left: 5px; /* 调整间距 */
            min-width: 45px; /* 调整宽度以适应 xxx.xxx */
            font-size: 14px; /* 统一字体大小 */
            text-align: right;
        }
        .planet-label {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: white; /* 确保颜色 */
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 12px;
            pointer-events: none; /* 标签不应捕获事件 */
            transition: opacity 0.3s ease;
            z-index: 150;
            white-space: nowrap; /* 防止标签换行 */
            transform: translateX(-50%); /* 使用 transform 水平居中 */
        }
        /* 行星弹出窗口样式 */
        .planet-popup {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #444;
            border-radius: 5px;
            padding: 10px;
            color: white;
            font-size: 14px;
            max-width: 200px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            z-index: 300;
            pointer-events: none;
            transform: translate(-50%, -110%);
        }
        .planet-popup h3 {
            margin: 0 0 8px 0;
            color: #FFC107;
        }
        .planet-popup p {
            margin: 4px 0;
        }
        /* 键盘快捷键提示样式 */
        .keyboard-shortcuts {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
        }
        .keyboard-shortcuts h3 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        .keyboard-shortcuts ul {
            margin: 0;
            padding-left: 20px;
        }
        .keyboard-shortcuts kbd {
            background: #333;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid #555;
        }
        /* 缩放提示样式 */
        .zoom-hint {
            position: absolute;
            bottom: 70px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
            color: white;
        }
        /* 当前缩放值的显示 */
        #zoom-value-display {
            position: absolute;
            bottom: 40px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
            color: white;
        }
        @media (max-width: 768px) {
            .controls {
                width: calc(100% - 20px); /* 调整宽度 */
                bottom: 10px;
                left: 10px;
                right: 10px;
                justify-content: center; /* 居中排列控制项 */
                gap: 8px; /* 减小间距 */
            }
            .slider-container {
                 width: auto; /* 让 flex 自动管理宽度 */
            }
             .slider-container input[type="range"] {
                width: 80px; /* 移动端减小滑块宽度 */
            }
            #info-panel {
                width: calc(90% - 30px); /* 调整宽度 */
                max-width: none;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                max-height: 80vh;
                z-index: 1000;
            }
            #info-panel.hidden {
                opacity: 0;
                transform: translate(-50%, -55%); /* 稍微向上移动隐藏 */
                pointer-events: none;
            }
            .planet-label {
                font-size: 10px;
                padding: 2px 4px;
            }
            #info-toggle-btn {
                 position: static; /* 在移动端让按钮成为 controls 的一部分 */
                 order: 5; /* 调整在 flex 布局中的顺序，如果需要 */
            }
             /* 隐藏整个面板的关闭按钮，因为面板居中了 */
            #info-panel > .close-button {
                 top: 10px;
                 right: 10px;
            }
            .keyboard-shortcuts {
                display: none; /* 在移动设备上隐藏键盘快捷键提示 */
            }
            .zoom-hint {
                bottom: 110px; /* 在移动设备上调整位置 */
            }
        }
    </style>
</head>
<body>
    <!-- 使用容器包裹 Canvas 和标签 -->
    <div id="simulation-container">
        <canvas id="solar-system"></canvas>
        <!-- 行星标签将动态添加到这里 -->
    </div>
    <div class="controls">
        <button id="pause-btn">暂停</button>
        <button id="reset-btn">重置</button>
        <button id="toggle-labels-btn">隐藏标签</button>
        <button id="toggle-trails-btn">显示轨迹</button>
        <div class="slider-container">
            <label for="speed-slider">速度:</label>
            <input type="range" id="speed-slider" min="0.001" max="2" step="0.001" value="0.01">
            <span id="speed-value">0.010x</span>
        </div>
        <button id="info-toggle-btn">隐藏信息</button>
    </div>
    <!-- 缩放值显示 -->
    <div id="zoom-value-display">缩放: 1.0x</div>
    <!-- 缩放提示 -->
    <div class="zoom-hint">使用鼠标滚轮或双指捏合缩放，按住拖动可移动视角</div>
    <!-- 信息面板 -->
    <div id="info-panel">
        <!-- 统一的关闭按钮 -->
        <button class="close-button" onclick="closeInfoPanel()">×</button>
        <div id="intro-content" class="intro-content">
            <h1>太阳系</h1>
            <p>点击任何天体查看详细信息。使用下方控制面板调整模拟。</p>
            <p>右键点击行星显示简要信息。</p>
        </div>
        <!-- 行星信息 Divs (保持不变) -->
        <div id="sun-info" class="planet-info">
            <h2>太阳</h2>
            <p>太阳是太阳系的中心天体，由氢和氦气体构成的恒星。</p>
            <ul>
                <li>直径: 1,392,700 公里</li>
                <li>质量: 1.989 × 10^30 公斤</li>
                <li>表面温度: 约 5,500°C</li>
                <li>类型: G型主序星</li>
                <li>年龄: 约46亿年</li>
                <li>自转周期: 约25.4天 (赤道)</li>
            </ul>
            <p>太阳占据了太阳系99.86%的质量，通过核聚变反应产生巨大的能量，为太阳系中的行星提供光和热。</p>
        </div>
        <div id="mercury-info" class="planet-info">
            <h2>水星</h2>
            <p>水星是离太阳最近的行星，也是太阳系中体积和质量最小的行星。</p>
            <ul>
                <li>直径: 4,879 公里</li>
                <li>质量: 3.3011 × 10^23 公斤</li>
                <li>轨道周期: 约 88 天</li>
                <li>自转周期: 约 58.6 天</li>
                <li>平均距离太阳: 5790万公里</li>
                <li>表面温度: -173°C 至 427°C</li>
            </ul>
            <p>水星没有明显的大气层，表面满是撞击坑，昼夜温差极大。</p>
        </div>
        <div id="venus-info" class="planet-info">
            <h2>金星</h2>
            <p>金星是太阳系中第二颗行星，大小与地球相似，但环境极端。</p>
            <ul>
                <li>直径: 12,104 公里</li>
                <li>质量: 4.8675 × 10^24 公斤</li>
                <li>轨道周期: 约 225 天</li>
                <li>自转周期: 约 243 天（逆行）</li>
                <li>平均距离太阳: 1.08亿公里</li>
                <li>表面温度: 约 462°C</li>
            </ul>
            <p>金星被厚厚的二氧化碳大气层覆盖，造成失控的温室效应，使其成为太阳系中最热的行星。</p>
        </div>
        <div id="earth-info" class="planet-info">
            <h2>地球</h2>
            <p>地球是太阳系中第三颗行星，也是目前已知唯一孕育生命的家园。</p>
            <ul>
                <li>直径: 12,742 公里</li>
                <li>质量: 5.97237 × 10^24 公斤</li>
                <li>轨道周期: 约 365.25 天</li>
                <li>自转周期: 约 23小时 56分</li>
                <li>平均距离太阳: 1.496亿公里</li>
                <li>平均表面温度: 约 15°C</li>
                <li>卫星: 1个（月球）</li>
            </ul>
            <p>地球表面的71%被液态水覆盖，拥有富含氮氧的大气层和保护性的磁场。</p>
        </div>
                  <div id="mars-info" class="planet-info">
            <h2>火星</h2>
            <p>火星是太阳系中第四颗行星，常被称为"红色星球"。</p>
            <ul>
                <li>直径: 6,779 公里</li>
                <li>质量: 6.4171 × 10^23 公斤</li>
                <li>轨道周期: 约 687 天</li>
                <li>自转周期: 约 24小时 37分</li>
                <li>平均距离太阳: 2.28亿公里</li>
                <li>表面温度: -153°C 至 20°C</li>
                <li>卫星: 2个（火卫一 Phobos, 火卫二 Deimos）</li>
            </ul>
            <p>火星表面有高山、峡谷和极地冰盖。过去可能存在液态水，是探索生命迹象的热点。</p>
        </div>
        <div id="jupiter-info" class="planet-info">
            <h2>木星</h2>
            <p>木星是太阳系中最大的行星，一颗气态巨行星。</p>
            <ul>
                <li>直径: 139,820 公里</li>
                <li>质量: 1.8982 × 10^27 公斤 (是其他行星总和的2.5倍)</li>
                <li>轨道周期: 约 11.86 年</li>
                <li>自转周期: 约 9小时 56分 (最快)</li>
                <li>平均距离太阳: 7.79亿公里</li>
                <li>云顶温度: 约 -145°C</li>
                <li>已知卫星: 95+</li>
            </ul>
            <p>木星主要由氢和氦组成，著名特征是大红斑——一个巨大的反气旋风暴。拥有强大的磁场和众多卫星。</p>
        </div>
        <div id="saturn-info" class="planet-info">
            <h2>土星</h2>
            <p>土星是太阳系中第六颗行星，以其壮观的环系统著称。</p>
            <ul>
                <li>直径: 116,460 公里</li>
                <li>质量: 5.6834 × 10^26 公斤</li>
                <li>轨道周期: 约 29.46 年</li>
                <li>自转周期: 约 10小时 33分</li>
                <li>平均距离太阳: 14.3亿公里</li>
                <li>云顶温度: 约 -178°C</li>
                <li>已知卫星: 146+ (包括土卫六 Titan)</li>
            </ul>
            <p>土星环主要由冰粒和少量岩石碎片组成。土星本身是密度最小的行星，比水还轻。</p>
        </div>
        <div id="uranus-info" class="planet-info">
            <h2>天王星</h2>
            <p>天王星是太阳系中第七颗行星，一颗冰巨星。</p>
            <ul>
                <li>直径: 50,724 公里</li>
                <li>质量: 8.6810 × 10^25 公斤</li>
                <li>轨道周期: 约 84.01 年</li>
                <li>自转周期: 约 17小时 14分 (逆行)</li>
                <li>平均距离太阳: 28.7亿公里</li>
                <li>云顶温度: 约 -224°C (最冷)</li>
                <li>已知卫星: 27+</li>
            </ul>
            <p>天王星以其极端的轴向倾斜（约98度）著称，几乎是"躺着"绕太阳公转。大气中的甲烷使其呈现蓝绿色。</p>
        </div>
        <div id="neptune-info" class="planet-info">
            <h2>海王星</h2>
            <p>海王星是太阳系中第八颗也是最远的行星，另一颗冰巨星。</p>
            <ul>
                <li>直径: 49,244 公里</li>
                <li>质量: 1.02413 × 10^26 公斤</li>
                <li>轨道周期: 约 164.8 年</li>
                <li>自转周期: 约 16小时 6分</li>
                <li>平均距离太阳: 45.0亿公里</li>
                <li>云顶温度: 约 -218°C</li>
                <li>已知卫星: 14+ (包括海卫一 Triton)</li>
            </ul>
            <p>海王星是第一个通过数学预测发现的行星。拥有太阳系中最强的风，速度可达2100公里/小时。</p>
        </div>
        <!-- 信息面板结束 -->
    </div>
    <!-- 键盘快捷键提示 -->
    <div class="keyboard-shortcuts">
        <h3>键盘快捷键</h3>
        <ul>
            <li><kbd>空格</kbd>: 暂停/继续</li>
            <li><kbd>R</kbd>: 重置</li>
            <li><kbd>L</kbd>: 切换标签</li>
            <li><kbd>T</kbd>: 切换轨迹</li>
            <li><kbd>I</kbd>: 切换信息面板</li>
            <li><kbd>+/-</kbd>: 调整速度</li>
            <li><kbd>鼠标滚轮</kbd>: 缩放</li>
        </ul>
    </div>
<script>
    const canvas = document.getElementById('solar-system');
    const ctx = canvas.getContext('2d');
    const simulationContainer = document.getElementById('simulation-container');
    const infoPanel = document.getElementById('info-panel');
    const introContent = document.getElementById('intro-content');
    const infoToggleBtn = document.getElementById('info-toggle-btn');
    const allPlanetInfoDivs = document.querySelectorAll('.planet-info');
    const toggleLabelsBtn = document.getElementById('toggle-labels-btn');
    const toggleTrailsBtn = document.getElementById('toggle-trails-btn');
    const zoomValueDisplay = document.getElementById('zoom-value-display');
    
    // 设置画布尺寸
    function resizeCanvas() {
        canvas.width = simulationContainer.clientWidth;
        canvas.height = simulationContainer.clientHeight;
        // 调整大小时重新创建标签，因为位置可能变化
        createLabels();
        // 重新生成星空背景
        stars = generateStarfield();
    }
    
    // 初始化时调整一次，并监听窗口大小变化
    window.addEventListener('resize', resizeCanvas);
    
    // 太阳系参数（距离和半径按比例调整以便显示，颜色为十六进制字符串）
    const planets = [
        { name: "sun", color: "FDB813", radius: 35, distance: 0, orbit: 0, speed: 0, angle: 0, moons: [], rings: false, showTrail: false, trail: [] },
        { name: "mercury", color: "B7B8B9", radius: 4, distance: 60, orbit: 88, speed: 0.041, angle: Math.random() * Math.PI * 2, moons: [], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "venus", color: "E7CDCD", radius: 8, distance: 90, orbit: 225, speed: 0.016, angle: Math.random() * Math.PI * 2, moons: [], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "earth", color: "267bef", radius: 9, distance: 130, orbit: 365, speed: 0.01, angle: Math.random() * Math.PI * 2, moons: [
            { name: "moon", distance: 15, radius: 2, orbit: 27, angle: 0, speed: 0.1 }
        ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "mars", color: "c1440e", radius: 6, distance: 180, orbit: 687, speed: 0.0053, angle: Math.random() * Math.PI * 2, moons: [
            { name: "phobos", distance: 10, radius: 1, orbit: 0.3, angle: 0, speed: 0.2 },
            { name: "deimos", distance: 14, radius: 1, orbit: 1.2, angle: Math.PI, speed: 0.15 }
        ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "jupiter", color: "e0b44e", radius: 25, distance: 280, orbit: 4333, speed: 0.0008, angle: Math.random() * Math.PI * 2, moons: [
            { name: "io", distance: 35, radius: 2, orbit: 1.7, angle: 0, speed: 0.05 },
            { name: "europa", distance: 40, radius: 2, orbit: 3.5, angle: Math.PI/2, speed: 0.04 },
            { name: "ganymede", distance: 45, radius: 3, orbit: 7.1, angle: Math.PI, speed: 0.03 },
            { name: "callisto", distance: 55, radius: 3, orbit: 16.7, angle: Math.PI*1.5, speed: 0.02 }
        ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "saturn", color: "f4d4a9", radius: 20, distance: 380, orbit: 10759, speed: 0.0003, angle: Math.random() * Math.PI * 2, moons: [
             { name: "titan", distance: 35, radius: 3, orbit: 16, angle: Math.PI/3, speed: 0.04 }
        ], rings: true, ringColor: "f4ebd2", ringInner: 25, ringOuter: 40, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "uranus", color: "BAFFFA", radius: 15, distance: 480, orbit: 30687, speed: 0.0001, angle: Math.random() * Math.PI * 2, moons: [
             { name: "miranda", distance: 22, radius: 1, orbit: 1.4, angle: Math.PI*1.2, speed: 0.03 }
        ], rings: true, ringColor: "e0faf8", ringInner: 18, ringOuter: 22, showTrail: false, trail: [], trailMaxPoints: 100 },
        { name: "neptune", color: "5B5DDF", radius: 14, distance: 580, orbit: 60190, speed: 0.00006, angle: Math.random() * Math.PI * 2, moons: [
             { name: "triton", distance: 25, radius: 2, orbit: 5.8, angle: Math.PI*0.8, speed: 0.02 }
        ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 }
    ];
    
    // 控制模拟参数
    let paused = false;
    let speed = 0.01;
    let zoom = 1;
    let baseX, baseY; // 基础中心点（画布中心）
    let offsetX = 0, offsetY = 0; // 中心点偏移量
    let centerX, centerY; // 实际渲染中心点
    let planetLabels = []; // 存储标签DOM元素
    let showLabels = true;
    let infoPanelVisible = true;
    let planetScreenData = []; // 存储行星屏幕坐标和大小
    let stars = []; // 星空背景
    
    // 拖动相关变量
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let lastOffsetX = 0;
    let lastOffsetY = 0;
    
    // 缩放相关变量
    let zoomMin = 0.2;
    let zoomMax = 5;
    let zoomStep = 0.1; // 每次缩放步长
    
    // 多点触控相关变量
    let touchDistance = 0;
    let touchZoomStartScale = 1;
    
    // 生成星空背景
    function generateStarfield() {
        const stars = [];
        const starCount = 200; // 星星数量
        for (let i = 0; i < starCount; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1.5 + 0.5, // 0.5到2之间的半径
                opacity: Math.random() * 0.8 + 0.2 // 0.2到1.0之间的透明度
            });
        }
        return stars;
    }
    
    // 绘制星空背景
    function drawStarfield() {
        stars.forEach(star => {
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
            ctx.fill();
        });
    }
    
    // 更新位置计算
    function updatePositions(timeScale) {
        planets.forEach(planet => {
            if (!paused && timeScale > 0) {
                // 行星轨道运动
                if (planet.speed > 0) {
                    planet.angle += (planet.speed * speed * timeScale);
                    planet.angle %= (Math.PI * 2);
                    // 记录轨迹点
                    if (planet.showTrail && planet.name !== "sun") {
                        const x = centerX + planet.distance * Math.cos(planet.angle) * zoom;
                        const y = centerY + planet.distance * Math.sin(planet.angle) * zoom;
                        // 只在一定间隔添加点，以避免点过密
                        if (planet.trail.length === 0 ||
                            Math.hypot(x - planet.trail[planet.trail.length-1].x,
                                    y - planet.trail[planet.trail.length-1].y) > 5) {
                            planet.trail.push({x, y});
                            // 限制轨迹点数量
                            if (planet.trail.length > planet.trailMaxPoints) {
                                planet.trail.shift();
                            }
                        }
                    }
                }
                // 卫星轨道运动
                if (planet.moons && Array.isArray(planet.moons)) {
                    planet.moons.forEach(moon => {
                        if (moon.speed > 0) {
                             moon.angle += (moon.speed * speed * timeScale * 5); // 让卫星转得更快些
                             moon.angle %= (Math.PI * 2);
                        }
                    });
                }
            }
        });
    }
    
    // 绘制天体（太阳、行星、卫星、环）
    function drawCelestialBody(planet) {
        const x = centerX + planet.distance * Math.cos(planet.angle) * zoom;
        const y = centerY + planet.distance * Math.sin(planet.angle) * zoom;
        const radius = planet.radius * zoom;
        
        // 绘制轨迹
        if (planet.showTrail && planet.trail.length > 1 && planet.name !== "sun") {
            ctx.beginPath();
            ctx.moveTo(planet.trail[0].x, planet.trail[0].y);
            for (let i = 1; i < planet.trail.length; i++) {
                ctx.lineTo(planet.trail[i].x, planet.trail[i].y);
            }
            ctx.strokeStyle = `#${planet.color}`;
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }
        
        // 特殊行星效果
        if (planet.name === "earth") {
            // 地球大气层效果
            ctx.beginPath();
            ctx.arc(x, y, radius * 1.05, 0, Math.PI * 2);
            let atmosphere = ctx.createRadialGradient(
                x, y, radius,
                x, y, radius * 1.05
            );
            atmosphere.addColorStop(0, "rgba(135, 206, 250, 0.5)");
            atmosphere.addColorStop(1, "rgba(135, 206, 250, 0)");
            ctx.fillStyle = atmosphere;
            ctx.fill();
        }
        
        if (planet.name === "jupiter") {
            // 绘制木星基本圆形
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            // 使用简单的纯色填充
            ctx.fillStyle = "#e0b44e"; // 木星的橙黄色
            ctx.fill();
            
            // 添加简单的阴影效果增加立体感
            ctx.beginPath();
            ctx.arc(x, y, radius, -Math.PI/2, Math.PI/2);
            ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
            ctx.fill();
            
            // 添加高光效果
            ctx.beginPath();
            ctx.arc(x, y, radius, Math.PI/2, -Math.PI/2);
            ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
            ctx.fill();
            
            // 添加大红斑
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(planet.angle * 0.03);
            ctx.beginPath();
            ctx.ellipse(radius * 0.3, -radius * 0.3, radius * 0.3, radius * 0.15, 0, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(187, 62, 3, 0.8)";
            ctx.fill();
            ctx.restore();
        }
        else if (planet.name === "saturn") {
            // 绘制土星本体
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = `#${planet.color}`;
            ctx.fill();
            ctx.save();
            ctx.translate(x, y);
            // 轻微旋转以模拟动态行星旋转
            ctx.rotate(planet.angle * 0.5);  
            ctx.restore();
        }
        
        // --- 太阳特殊绘制 ---
        if (planet.name === "sun") {
            ctx.save(); // 保存状态，隔离太阳的特殊效果
            
            // 1. 太阳辉光 (模拟 CSS box-shadow)
            ctx.shadowColor = `#${planet.color}`; // 使用行星颜色作为基准
            ctx.shadowBlur = 30 * zoom; // 辉光模糊半径，随缩放调整
            
            // 2. 太阳表面渐变 (模拟 CSS radial-gradient)
            const gradX = x; // 渐变中心X (保持在中心)
            const gradY = y; // 渐变中心Y
            const gradient = ctx.createRadialGradient(
                gradX, gradY, radius * 0.1, // 内圆 (小，中心)
                gradX, gradY, radius        // 外圆 (覆盖整个太阳)
            );
            
            // 添加颜色断点 (从亮黄到橙红)
            gradient.addColorStop(0, "#FFF7A0"); // 中心更亮
            gradient.addColorStop(0.6, `#${planet.color}`); // 主体颜色
            gradient.addColorStop(1, "#FF4500"); // 边缘橙红
            ctx.fillStyle = gradient;
            
            // 3. 绘制太阳圆
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore(); // 恢复状态 (移除阴影, 重置填充样式)
        }
        // --- 其他行星绘制 ---
        else {
            // 1. 绘制轨道
            if (planet.distance > 0) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, planet.distance * zoom, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(255, 255, 255, 0.15)"; // 稍微调亮轨道
                ctx.lineWidth = 1;
                ctx.stroke();
            }
            
            // 2. 绘制环 (在行星之前绘制)
            if (planet.rings) {
                ctx.save();
                ctx.translate(x, y);
                 // 稍微倾斜环以模拟视角
                ctx.rotate(planet.angle * 0.05 + Math.PI / 12); // 轻微旋转+固定倾斜
                ctx.scale(1, 0.35); // 压扁成椭圆
                const ringOuterRadius = planet.ringOuter * zoom;
                const ringInnerRadius = planet.ringInner * zoom;
                
                // 绘制环带颜色 (半透明)
                ctx.beginPath();
                ctx.arc(0, 0, ringOuterRadius, 0, Math.PI * 2);
                ctx.arc(0, 0, ringInnerRadius, 0, Math.PI * 2, true); // 逆时针挖掉内部
                ctx.fillStyle = planet.ringColor ? `#${planet.ringColor}80` : "rgba(200, 200, 200, 0.5)"; // 添加透明度
                ctx.fill();
                
                 // 可选：绘制环的边缘线增加清晰度
                 ctx.beginPath();
                 ctx.arc(0, 0, ringOuterRadius, 0, Math.PI * 2);
                 ctx.strokeStyle = planet.ringColor ? `#${planet.ringColor}B0` : "rgba(220, 220, 220, 0.7)";
                 ctx.lineWidth = 1 / 0.35; // 因为缩放了，线宽要反向调整
                 ctx.stroke();
                 
                 ctx.beginPath();
                 ctx.arc(0, 0, ringInnerRadius, 0, Math.PI * 2);
                 ctx.strokeStyle = planet.ringColor ? `#${planet.ringColor}B0` : "rgba(220, 220, 220, 0.7)";
                 ctx.lineWidth = 1 / 0.35;
                 ctx.stroke();
                 
                ctx.restore();
            }
            
            // 3. 绘制行星本体
            ctx.beginPath();
            ctx.arc(x, y, Math.max(1, radius), 0, Math.PI * 2); // 保证最小半径为1像素
            ctx.fillStyle = `#${planet.color}`;
            ctx.fill();
            
            // 4. 绘制卫星及其轨道
            if (planet.moons && Array.isArray(planet.moons)) {
                planet.moons.forEach(moon => {
                    const moonOrbitRadius = moon.distance * zoom;
                    const moonX = x + moonOrbitRadius * Math.cos(moon.angle);
                    const moonY = y + moonOrbitRadius * Math.sin(moon.angle);
                    const moonRadius = Math.max(1, moon.radius * zoom); // 保证最小半径
                    
                    // 绘制卫星轨道 (更细、更暗)
                    ctx.beginPath();
                    ctx.arc(x, y, moonOrbitRadius, 0, Math.PI * 2);
                    ctx.strokeStyle = "rgba(255, 255, 255, 0.08)";
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                    
                    // 绘制卫星
                    ctx.beginPath();
                    ctx.arc(moonX, moonY, moonRadius, 0, Math.PI * 2);
                    ctx.fillStyle = "#CCCCCC"; // 卫星统一用灰色
                    ctx.fill();
                });
            }
        } // --- End of else (non-sun) ---
        
        // --- 更新标签位置 (对所有天体都执行) ---
        const labelElem = document.getElementById(`${planet.name}-label`);
        if (labelElem) {
            // 定位在天体正上方
            const labelTop = y - radius - labelElem.offsetHeight - 5; // 5px间距
            // 使用 transform translateX(-50%) 来居中
            labelElem.style.left = `${x}px`;
            labelElem.style.top = `${labelTop}px`;
            labelElem.style.opacity = showLabels ? "1" : "0";
            // 标签不应阻止对行星的点击
            labelElem.style.pointerEvents = 'none';
        }
        
        // 返回屏幕坐标和大小，用于点击检测
        return { x, y, radius: radius, name: planet.name };
    }
    
    // 创建或更新行星标签
    function createLabels() {
        // 清除旧标签 (如果存在)
        planetLabels.forEach(label => label.remove());
        planetLabels = []; // 清空数组
        
        // 为每个行星创建标签并添加到容器
        planets.forEach(planet => {
            const label = document.createElement('div');
            label.id = `${planet.name}-label`;
            label.className = 'planet-label';
            
            // 简单的名称映射
            const nameMap = {
                sun: "太阳", mercury: "水星", venus: "金星", earth: "地球",
                mars: "火星", jupiter: "木星", saturn: "土星",
                uranus: "天王星", neptune: "海王星"
            };
            
            label.textContent = nameMap[planet.name] || planet.name;
            label.style.opacity = showLabels ? "1" : "0"; // 设置初始透明度
            label.style.pointerEvents = 'none'; // 标签不应捕获事件
            
            simulationContainer.appendChild(label); // 添加到容器中
            planetLabels.push(label);
        });
    }
    
    // 创建行星弹出窗口
    function createPlanetPopup() {
        // 创建弹出窗口元素
        const popup = document.createElement('div');
        popup.id = 'planet-popup';
        popup.className = 'planet-popup';
        popup.style.display = 'none';
        
        // 添加到容器
        simulationContainer.appendChild(popup);
        return popup;
    }
    
    // 显示行星弹出信息
    function showPlanetPopup(planetData, clientX, clientY) {
        const popup = document.getElementById('planet-popup');
        if (!popup) return;
        
        // 找到行星数据
        const planet = planets.find(p => p.name === planetData.name);
        if (!planet) return;
        
        // 名称映射
        const nameMap = {
            sun: "太阳", mercury: "水星", venus: "金星", earth: "地球",
            mars: "火星", jupiter: "木星", saturn: "土星",
            uranus: "天王星", neptune: "海王星"
        };
        
        // 行星轨道周期天数转为年或天的表示
        let orbitPeriod = planet.orbit;
        let orbitUnit = '天';
        if (orbitPeriod > 365) {
            orbitPeriod = (orbitPeriod / 365).toFixed(1);
            orbitUnit = '年';
        }
        
        // 填充内容
        popup.innerHTML = `
            <h3>${nameMap[planet.name] || planet.name}</h3>
            <p>半径: ${planet.radius} 像素</p>
            <p>距太阳: ${planet.distance} 像素</p>
            ${planet.orbit ? `<p>公转周期: ${orbitPeriod} ${orbitUnit}</p>` : ''}
            ${planet.moons.length ? `<p>卫星数: ${planet.moons.length}</p>` : ''}
            ${planet.rings ? `<p>有光环</p>` : ''}
        `;
        
        // 设置位置 (跟随鼠标)
        popup.style.left = `${clientX}px`;
        popup.style.top = `${clientY}px`;
        popup.style.display = 'block';
        
        // 设置自动隐藏
        if (window.popupTimeout) clearTimeout(window.popupTimeout);
        window.popupTimeout = setTimeout(() => {
            popup.style.display = 'none';
        }, 3000);
    }
    
    // 显示介绍内容
    function showIntroContent() {
        introContent.style.display = 'block';
        allPlanetInfoDivs.forEach(elem => {
            elem.style.display = 'none';
        });
        
        // 确保面板可见
        if (!infoPanelVisible) {
            toggleInfoPanel(); // 调用切换函数来显示
        }
        infoPanel.scrollTop = 0; // 滚动到顶部
    }
    
    // 关闭整个信息面板
    function closeInfoPanel() {
        infoPanel.classList.add('hidden');
        infoPanelVisible = false;
        infoToggleBtn.textContent = '显示信息';
    }
    
    // 使函数全局可用，以便 onclick 调用
    window.closeInfoPanel = closeInfoPanel;
    
    // 切换信息面板可见性
    function toggleInfoPanel() {
        infoPanelVisible = !infoPanelVisible;
        if (infoPanelVisible) {
            infoPanel.classList.remove('hidden');
            infoToggleBtn.textContent = '隐藏信息';
            
            // 如果当前没有显示行星信息，则显示介绍
            const anyPlanetInfoVisible = Array.from(allPlanetInfoDivs).some(div => div.style.display === 'block');
            if (!anyPlanetInfoVisible) {
                 showIntroContent(); // 打开时默认显示介绍
            }
        } else {
            infoPanel.classList.add('hidden');
            infoToggleBtn.textContent = '显示信息';
        }
    }
    
    // 更新缩放值显示
    function updateZoomValueDisplay() {
        zoomValueDisplay.textContent = `缩放: ${zoom.toFixed(1)}x`;
    }
    
    // 缩放功能实现
    function handleZoom(delta, clientX, clientY) {
        const oldZoom = zoom;
        
        // 计算新的缩放值，限制在最小和最大缩放范围内
        zoom = Math.max(zoomMin, Math.min(zoomMax, zoom + delta * zoomStep));
        
        // 更新缩放值显示
        updateZoomValueDisplay();
        
        // 如果缩放到最小值，重置中心点偏移
        if (zoom <= zoomMin) {
            offsetX = 0;
            offsetY = 0;
        }
        
        // 清除所有轨迹，因为缩放后轨迹会不匹配
        planets.forEach(planet => {
            if (planet.name !== "sun") {
                planet.trail = [];
            }
        });
    }
    
    // 设置缩放和拖动事件监听器
    function setupInteractionControls() {
        // 鼠标滚轮缩放
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            // 滚轮向上为负值，向下为正值，我们要反转方向
            const delta = -Math.sign(e.deltaY);
            handleZoom(delta, e.clientX, e.clientY);
        });
        
        // 鼠标拖动处理
        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 0) { // 只处理左键
                e.preventDefault();
                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                lastOffsetX = offsetX;
                lastOffsetY = offsetY;
                canvas.classList.add('grabbing');
            }
        });
        
        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = e.clientX - dragStartX;
                const dy = e.clientY - dragStartY;
                
                // 根据当前缩放级别调整拖动敏感度
                offsetX = lastOffsetX + dx;
                offsetY = lastOffsetY + dy;
                
                // 清除所有轨迹，因为拖动后轨迹会不匹配
                planets.forEach(planet => {
                    if (planet.name !== "sun") {
                        planet.trail = [];
                    }
                });
            }
        });
        
        window.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                canvas.classList.remove('grabbing');
            }
        });
        
        // 触摸事件处理（双指缩放和单指拖动）
        let initialDistance = 0;
        let isZooming = false;
        let isTouchDragging = false;
        let touchStartX = 0;
        let touchStartY = 0;
        
        // 触摸开始
        simulationContainer.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                isZooming = true;
                isTouchDragging = false;
                
                // 计算两个触摸点之间的初始距离
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                initialDistance = Math.sqrt(dx * dx + dy * dy);
                touchZoomStartScale = zoom;
            } 
            else if (e.touches.length === 1) {
                isZooming = false;
                isTouchDragging = true;
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                lastOffsetX = offsetX;
                lastOffsetY = offsetY;
            }
        });
        
        // 触摸移动
        simulationContainer.addEventListener('touchmove', (e) => {
            if (isZooming && e.touches.length === 2) {
                e.preventDefault(); // 阻止默认行为以防止页面滚动
                
                // 计算当前触摸点之间的距离
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const currentDistance = Math.sqrt(dx * dx + dy * dy);
                
                // 计算缩放比例变化
                const scaleFactor = currentDistance / initialDistance;
                
                // 应用新的缩放值，并确保在范围内
                zoom = Math.max(zoomMin, Math.min(zoomMax, touchZoomStartScale * scaleFactor));
                
                // 如果缩放到最小值，重置中心点偏移
                if (zoom <= zoomMin) {
                    offsetX = 0;
                    offsetY = 0;
                }
                
                // 更新缩放值显示
                updateZoomValueDisplay();
                
                // 清除所有轨迹
                planets.forEach(planet => {
                    if (planet.name !== "sun") {
                        planet.trail = [];
                    }
                });
            }
            else if (isTouchDragging && e.touches.length === 1) {
                const touchX = e.touches[0].clientX;
                const touchY = e.touches[0].clientY;
                
                const dx = touchX - touchStartX;
                const dy = touchY - touchStartY;
                
                offsetX = lastOffsetX + dx;
                offsetY = lastOffsetY + dy;
                
                // 清除所有轨迹
                planets.forEach(planet => {
                    if (planet.name !== "sun") {
                        planet.trail = [];
                    }
                });
            }
        });
        
        // 触摸结束
        simulationContainer.addEventListener('touchend', () => {
            isZooming = false;
            isTouchDragging = false;
        });
        
        // 触摸取消
        simulationContainer.addEventListener('touchcancel', () => {
            isZooming = false;
            isTouchDragging = false;
        });
    }
    
    // 主绘制循环
    let lastTimestamp = 0;
    function draw(timestamp) {
        const timeDelta = timestamp - lastTimestamp;
        // 限制时间增量，防止标签页挂起后动画跳跃过大
        const timeScale = Math.min(timeDelta / (1000 / 60), 5); // (假设60fps)
        lastTimestamp = timestamp;
        
        // 清除画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 更新基础中心点和实际渲染中心点
        baseX = canvas.width / 2;
        baseY = canvas.height / 2;
        centerX = baseX + offsetX;
        centerY = baseY + offsetY;
        
        // 绘制星空背景
        drawStarfield();
        
        // 更新天体位置
        updatePositions(timeScale);
        
        // 绘制所有天体并存储屏幕数据
        planetScreenData = planets.map(planet => drawCelestialBody(planet));
        
        // 请求下一帧
        requestAnimationFrame(draw);
    }
    
    // 切换轨迹显示/隐藏
    function toggleTrails() {
        const allTrailsOn = planets.every(p => p.name === "sun" || p.showTrail);
        planets.forEach(planet => {
            if (planet.name !== "sun") {
                planet.showTrail = !allTrailsOn;
                // 如果关闭轨迹，清空轨迹点
                if (!planet.showTrail) {
                    planet.trail = [];
                }
            }
        });
        toggleTrailsBtn.textContent = allTrailsOn ? '显示轨迹' : '隐藏轨迹';
    }
    
    // 设置键盘控制
    function setupKeyboardControls() {
        window.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':  // 空格键：暂停/继续
                    togglePause();
                    break;
                case 'r':  // r：重置
                case 'R':
                    resetSimulation();
                    break;
                case 'l':  // l：切换标签
                case 'L':
                    toggleLabels();
                    break;
                case 't':  // t：切换轨迹
                case 'T':
                    toggleTrails();
                    break;
                case 'i':  // i：切换信息面板
                case 'I':
                    toggleInfoPanel();
                    break;
                case '+':  // +：增加速度
                case '=':  // =：增加速度 (同一个键)
                    changeSpeed(0.01);
                    break;
                case '-':  // -：减少速度
                    changeSpeed(-0.01);
                    break;
                case 'ArrowUp':  // 向上箭头：增加缩放
                    handleZoom(1, canvas.width/2, canvas.height/2);
                    break;
                case 'ArrowDown':  // 向下箭头：减少缩放
                    handleZoom(-1, canvas.width/2, canvas.height/2);
                    break;
            }
        });
    }
    
    // 修改速度的辅助函数
    function changeSpeed(delta) {
        const speedSlider = document.getElementById('speed-slider');
        let newSpeed = parseFloat(speedSlider.value) + delta;
        newSpeed = Math.max(parseFloat(speedSlider.min), Math.min(parseFloat(speedSlider.max), newSpeed));
        speedSlider.value = newSpeed;
        // 触发 input 事件以更新显示
        speedSlider.dispatchEvent(new Event('input'));
    }
    
    // 初始化函数
    function init() {
        // 设置画布初始大小
        resizeCanvas(); // 这也会调用 createLabels 和生成星空
        
        // 创建行星弹出窗口
        createPlanetPopup();
        
        // 设置控制面板初始值
        document.getElementById('speed-slider').value = speed;
        document.getElementById('speed-value').textContent = speed.toFixed(3) + 'x';
        updateZoomValueDisplay(); // 初始化缩放值显示
        document.getElementById('pause-btn').textContent = paused ? '播放' : '暂停';
        toggleLabelsBtn.textContent = showLabels ? '隐藏标签' : '显示标签';
        toggleTrailsBtn.textContent = '显示轨迹';
        infoToggleBtn.textContent = infoPanelVisible ? '隐藏信息' : '显示信息';
        
        if (!infoPanelVisible) infoPanel.classList.add('hidden');
        else showIntroContent(); // 初始显示介绍
        
        // 添加事件监听器
        canvas.addEventListener('click', handleCanvasClick);
        canvas.addEventListener('contextmenu', (e) => e.preventDefault());
        document.getElementById('pause-btn').addEventListener('click', togglePause);
        document.getElementById('reset-btn').addEventListener('click', resetSimulation);
        toggleLabelsBtn.addEventListener('click', () => toggleLabels()); // 切换标签
        toggleTrailsBtn.addEventListener('click', toggleTrails); // 切换轨迹
        document.getElementById('speed-slider').addEventListener('input', updateSpeed);
        infoToggleBtn.addEventListener('click', toggleInfoPanel);
        
        // 设置缩放和拖动控制
        setupInteractionControls();
        
        // 设置键盘控制
        setupKeyboardControls();
        
        // 更新初始中心点
        baseX = canvas.width / 2;
        baseY = canvas.height / 2;
        centerX = baseX;
        centerY = baseY;
        
        // 启动动画循环
        requestAnimationFrame(draw);
    }
    
    // 处理画布点击事件
    function handleCanvasClick(event) {
        // 如果正在拖动，不处理点击
        if (isDragging) return;
        
        // 阻止默认右键菜单
        if (event.button === 2) {
            event.preventDefault();
        }
        
        const rect = canvas.getBoundingClientRect();
        const clickX = event.clientX - rect.left;
        const clickY = event.clientY - rect.top;
        
        let clickedPlanetName = null;
        
        // 从后往前检查（外层行星先检查），或者按绘制顺序检查（太阳先检查）
        for (const planetData of planetScreenData) {
            if (!planetData) continue; // 跳过无效数据
            
            const distance = Math.sqrt(Math.pow(clickX - planetData.x, 2) + Math.pow(clickY - planetData.y, 2));
            
            // 点击半径稍微放大一点，更容易点中
            const clickRadius = Math.max(planetData.radius, 10); // 最小点击区域为10px半径
            
            if (distance <= clickRadius) {
                clickedPlanetName = planetData.name;
                
                // 如果是右键点击，显示弹出信息
                if (event.button === 2) {
                    showPlanetPopup(planetData, event.clientX, event.clientY);
                    return;
                }
                break; // 找到第一个（最上层）被点击的
            }
        }
        
        if (clickedPlanetName && event.button === 0) {
            // 隐藏介绍和其他行星信息
            introContent.style.display = 'none';
            allPlanetInfoDivs.forEach(elem => {
                elem.style.display = 'none';
            });
            
            // 显示被点击行星的信息
            const planetInfoDiv = document.getElementById(`${clickedPlanetName}-info`);
            if (planetInfoDiv) {
                planetInfoDiv.style.display = 'block';
                
                // 点击行星时确保面板可见并滚动到顶部
                if (!infoPanelVisible) {
                    toggleInfoPanel(); // 调用切换函数来显示
                }
                infoPanel.scrollTop = 0;
            } else {
                // 如果没有找到对应的 info div，显示介绍
                showIntroContent();
            }
        }
    }
    
    // 切换暂停/播放
    function togglePause() {
        paused = !paused;
        document.getElementById('pause-btn').textContent = paused ? '播放' : '暂停';
    }
    
    // 切换标签显示/隐藏
    function toggleLabels(forceState = null) {
        showLabels = (forceState !== null) ? forceState : !showLabels;
        planetLabels.forEach(label => {
            if (label) {
                label.style.opacity = showLabels ? "1" : "0";
            }
        });
        
        // 更新按钮文本
        toggleLabelsBtn.textContent = showLabels ? '隐藏标签' : '显示标签';
    }
    
    // 重置模拟状态
    function resetSimulation() {
        // 重置行星和卫星角度为随机初始值（或固定值）
        planets.forEach(planet => {
            planet.angle = Math.random() * Math.PI * 2; // 重置为随机角度
            planet.trail = []; // 清空轨迹
            
            if (planet.moons && Array.isArray(planet.moons)) {
                planet.moons.forEach((moon, index) => {
                    moon.angle = (index * Math.PI / (planet.moons.length || 1)); // 均匀分布卫星初始角度
                });
            }
        });
        
        // 重置控制参数
        speed = 0.01;
        document.getElementById('speed-slider').value = speed;
        document.getElementById('speed-value').textContent = speed.toFixed(3) + 'x';
        
        zoom = 1;
        updateZoomValueDisplay();
        
        // 重置中心点偏移
        offsetX = 0;
        offsetY = 0;
        
        paused = false;
        document.getElementById('pause-btn').textContent = '暂停';
        
        // 重置标签显示状态和按钮文本
        showLabels = true;
        toggleLabels(true); // 强制显示标签
        
        // 关闭所有行星轨迹
        planets.forEach(planet => {
            planet.showTrail = false;
        });
        toggleTrailsBtn.textContent = '显示轨迹';
        
        // 重置信息面板到介绍视图
        showIntroContent();
        
        // 重新创建标签以适应可能的缩放重置
        createLabels();
    }
    
    // 更新模拟速度
    function updateSpeed(event) {
        speed = parseFloat(event.target.value);
        document.getElementById('speed-value').textContent = speed.toFixed(3) + 'x';
    }
    
    // 初始化应用
    init();
</script>
</body>
</html>