<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªé˜³ç³»æ¨¡æ‹Ÿ</title>
    <!-- å¼•å…¥JavaScriptåº“ -->
    <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/dat.gui@0.7.9/build/dat.gui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    <script src="https://unpkg.com/hammerjs@2.0.8/hammer.min.js"></script>
    <!-- å¤‡ç”¨CDNï¼Œå¦‚æœä¸»CDNå¤±è´¥ä¼šè‡ªåŠ¨ä½¿ç”¨å¤‡ç”¨ -->
    <script>
        // æ£€æµ‹åº“æ˜¯å¦æˆåŠŸåŠ è½½ï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨å¤‡ç”¨CDN
        window.addEventListener('DOMContentLoaded', function() {
            const libraries = [
                {
                    test: () => typeof THREE !== 'undefined',
                    backup: 'https://lib.baomitu.com/three.js/r128/three.min.js'
                },
                {
                    test: () => typeof gsap !== 'undefined',
                    backup: 'https://lib.baomitu.com/gsap/3.11.4/gsap.min.js'
                },
                {
                    test: () => typeof dat !== 'undefined',
                    backup: 'https://lib.baomitu.com/dat-gui/0.7.9/dat.gui.min.js'
                },
                {
                    test: () => typeof Stats !== 'undefined',
                    backup: 'https://lib.baomitu.com/stats.js/r17/Stats.min.js'
                },
                {
                    test: () => typeof Hammer !== 'undefined',
                    backup: 'https://lib.baomitu.com/hammer.js/2.0.8/hammer.min.js'
                }
            ];

            libraries.forEach(lib => {
                if (!lib.test()) {
                    const script = document.createElement('script');
                    script.src = lib.backup;
                    document.head.appendChild(script);
                }
            });
        });
    </script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            color: white;
        }
        #simulation-container {
            position: relative;
            width: 100%;
            height: 100vh;
            touch-action: none;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab;
            transition: filter 0.3s ease;
        }
        canvas.grabbing {
            cursor: grabbing;
        }
        canvas.glow-effect {
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }
        #info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(20, 20, 40, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            max-width: 320px;
            max-height: calc(100vh - 20px);
            overflow-y: auto;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 200;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        #info-panel>.close-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 210;
        }
        #info-panel>.close-button:hover {
            background: linear-gradient(135deg, #ff5252, #d32f2f);
            transform: scale(1.1);
        }
        h1, h2 {
            margin-top: 0;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #64b5f6, #1976d2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .intro-content {
            position: relative;
            display: block;
        }
        .planet-info {
            display: none;
            position: relative;
        }
        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(30, 30, 50, 0.9) 100%);
            backdrop-filter: blur(15px);
            padding: 15px;
            border-radius: 15px;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            font-weight: 500;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            background: linear-gradient(135deg, #66BB6A, #4CAF50);
        }
        button:active {
            transform: translateY(0);
        }
        #settings-popup {
            position: absolute;
            bottom: 80px;
            left: 10px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(30, 30, 50, 0.95) 100%);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            z-index: 150;
            display: none;
            width: 320px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        #settings-popup .close-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        #settings-popup h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #64b5f6;
        }
        #settings-popup .settings-group {
            margin-bottom: 20px;
        }
        #settings-popup .slider-container {
            margin-bottom: 15px;
        }
        #info-panel.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(20px) scale(0.95);
        }
        .slider-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            border-radius: 10px;
            margin: 5px 0;
        }
        .slider-container label {
            margin-right: 10px;
            min-width: 60px;
            font-size: 14px;
            font-weight: 500;
        }
        .slider-container input[type="range"] {
            width: 120px;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(135deg, #e0e0e0, #bdbdbd);
            outline: none;
            -webkit-appearance: none;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #64b5f6, #1976d2);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-container span {
            margin-left: 10px;
            min-width: 60px;
            font-size: 14px;
            text-align: right;
            color: #64b5f6;
            font-weight: 500;
        }
        .planet-label {
            position: absolute;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(20, 20, 40, 0.9) 100%);
            backdrop-filter: blur(8px);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 150;
            white-space: nowrap;
            transform: translateX(-50%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-weight: 500;
        }
        .planet-popup {
            position: absolute;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(30, 30, 50, 0.95) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 15px;
            padding: 15px;
            color: white;
            font-size: 14px;
            max-width: 250px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 300;
            pointer-events: none;
            transform: translate(-50%, -110%);
        }
        .planet-popup h3 {
            margin: 0 0 10px 0;
            color: #FFC107;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .planet-popup p {
            margin: 6px 0;
            line-height: 1.4;
        }
        .keyboard-shortcuts {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(20, 20, 40, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .keyboard-shortcuts h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #64b5f6;
        }
        .keyboard-shortcuts ul {
            margin: 0;
            padding-left: 20px;
        }
        .keyboard-shortcuts kbd {
            background: linear-gradient(135deg, #424242, #303030);
            padding: 3px 6px;
            border-radius: 6px;
            border: 1px solid #555;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: monospace;
        }
        .zoom-hint, #zoom-value-display, .asteroid-info {
            position: absolute;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(20, 20, 40, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-weight: 500;
        }
        .zoom-hint {
            bottom: 80px;
            left: 10px;
        }
        #zoom-value-display {
            bottom: 50px;
            left: 10px;
            color: #64b5f6;
        }
        .asteroid-info {
            bottom: 120px;
            left: 10px;
        }
        /* ç²’å­æ•ˆæœå®¹å™¨ */
        #particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        /* æ€§èƒ½ç›‘æ§å™¨ */
        #stats {
            position: absolute !important;
            top: 10px !important;
            left: 10px !important;
            z-index: 1000 !important;
        }
        /* éŸ³æ•ˆæ§åˆ¶ */
        .audio-controls {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(20, 20, 40, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 25px;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* å“åº”å¼è®¾è®¡ä¼˜åŒ– */
        @media (max-width: 768px) {
            .controls {
                width: calc(100% - 20px);
                bottom: 10px;
                left: 10px;
                right: 10px;
                justify-content: center;
                gap: 10px;
                padding: 12px;
            }
            .slider-container input[type="range"] {
                width: 100px;
            }
            #info-panel {
                width: calc(90% - 30px);
                max-width: none;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                max-height: 80vh;
                z-index: 1000;
            }
            #info-panel.hidden {
                opacity: 0;
                transform: translate(-50%, -55%) scale(0.95);
                pointer-events: none;
            }
            .planet-label {
                font-size: 10px;
                padding: 4px 8px;
            }
            #settings-popup {
                width: calc(100% - 40px);
                left: 10px;
                right: 10px;
            }
            .keyboard-shortcuts {
                display: none;
            }
            .zoom-hint {
                bottom: 120px;
            }
            .audio-controls {
                top: auto;
                bottom: 160px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 12px;
                padding: 8px 12px;
            }
        }
        /* åŠ è½½åŠ¨ç”» */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #64b5f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½å±å¹• -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-spinner"></div>
    </div>

    <!-- ç²’å­æ•ˆæœå®¹å™¨ -->
    <div id="particles-container"></div>


    <!-- ä¸»æ¨¡æ‹Ÿå®¹å™¨ -->
    <div id="simulation-container">
        <canvas id="solar-system"></canvas>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="controls">
        <button id="pause-btn">â¸ï¸ æš‚åœ</button>
        <button id="reset-btn">ğŸ”„ é‡ç½®</button>
        <button id="settings-btn">âš™ï¸ è®¾ç½®</button>
        <button id="fullscreen-btn">ğŸ–¥ï¸ å…¨å±</button>
        <button id="screenshot-btn">ğŸ“· æˆªå›¾</button>
    </div>

    <!-- è®¾ç½®å¼¹å‡ºçª—å£ -->
    <div id="settings-popup">
        <button class="close-button" id="settings-close-btn">Ã—</button>
        <h3>âš™ï¸ é«˜çº§è®¾ç½®</h3>
        <div class="settings-group">
            <button id="toggle-trails-btn">ğŸŒŸ æ˜¾ç¤ºè½¨è¿¹</button>
            <button id="toggle-asteroid-belt-btn">ğŸª¨ æ˜¾ç¤ºå°è¡Œæ˜Ÿå¸¦</button>
            <button id="info-toggle-btn">â„¹ï¸ éšè—ä¿¡æ¯</button>
            <button id="toggle-glow-btn">âœ¨ å‘å…‰æ•ˆæœ</button>
        </div>
        <div class="settings-group">
            <div class="slider-container">
                <label for="speed-slider">ğŸš€ é€Ÿåº¦:</label>
                <input type="range" id="speed-slider" min="0.001" max="3" step="0.001" value="0.01">
                <span id="speed-value">0.010x</span>
            </div>
            <div class="slider-container">
                <label for="quality-slider">ğŸ¨ è´¨é‡:</label>
                <input type="range" id="quality-slider" min="0.5" max="2" step="0.1" value="1">
                <span id="quality-value">1.0x</span>
            </div>
            <button id="toggle-labels-btn">ğŸ·ï¸ éšè—æ ‡ç­¾</button>
            <button id="click-sound-toggle">ğŸ”Š ç‚¹å‡»éŸ³æ•ˆ: å¼€</button>
        </div>
    </div>

    <!-- ç¼©æ”¾å€¼æ˜¾ç¤º -->
    <div id="zoom-value-display">ğŸ” ç¼©æ”¾: 1.0x</div>

    <!-- ç¼©æ”¾æç¤º -->
    <div class="zoom-hint">ğŸ–±ï¸ é¼ æ ‡æ»šè½®ç¼©æ”¾ | ğŸ¤ åŒæŒ‡æåˆç¼©æ”¾ | ğŸ–±ï¸ æ‹–åŠ¨ç§»åŠ¨è§†è§’</div>

    <!-- å°è¡Œæ˜Ÿå¸¦ä¿¡æ¯ -->
    <div class="asteroid-info" id="asteroid-info" style="display: none;">ğŸª¨ å°è¡Œæ˜Ÿå¸¦å·²å¯ç”¨</div>

    <!-- ä¿¡æ¯é¢æ¿ -->
    <div id="info-panel">
        <button class="close-button" onclick="closeInfoPanel()">Ã—</button>
        <div id="intro-content" class="intro-content">
            <h1>ğŸŒŒ å¤ªé˜³ç³»æ¨¡æ‹Ÿå™¨</h1>
            <p>ğŸ¯ ç‚¹å‡»ä»»ä½•å¤©ä½“æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
            <p>ğŸ–±ï¸ å³é”®ç‚¹å‡»è¡Œæ˜Ÿæ˜¾ç¤ºç®€è¦ä¿¡æ¯</p>
            <p>âš™ï¸ ä½¿ç”¨ä¸‹æ–¹æ§åˆ¶é¢æ¿è°ƒæ•´æ¨¡æ‹Ÿå‚æ•°</p>
            <p>ğŸ® æ”¯æŒé”®ç›˜å¿«æ·é”®æ“ä½œ</p>
        </div>
        
        <!-- è¡Œæ˜Ÿä¿¡æ¯Divsä¿æŒåŸæ · -->
        <div id="sun-info" class="planet-info">
            <h2>â˜€ï¸ å¤ªé˜³</h2>
            <p>å¤ªé˜³æ˜¯å¤ªé˜³ç³»çš„ä¸­å¿ƒå¤©ä½“ï¼Œç”±æ°¢å’Œæ°¦æ°”ä½“æ„æˆçš„æ’æ˜Ÿã€‚</p>
            <ul>
                <li>ç›´å¾„: 1,392,700 å…¬é‡Œ</li>
                <li>è´¨é‡: 1.989 Ã— 10^30 å…¬æ–¤</li>
                <li>è¡¨é¢æ¸©åº¦: çº¦ 5,500Â°C</li>
                <li>ç±»å‹: Gå‹ä¸»åºæ˜Ÿ</li>
                <li>å¹´é¾„: çº¦46äº¿å¹´</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦25.4å¤© (èµ¤é“)</li>
            </ul>
            <p>å¤ªé˜³å æ®äº†å¤ªé˜³ç³»99.86%çš„è´¨é‡ï¼Œé€šè¿‡æ ¸èšå˜ååº”äº§ç”Ÿå·¨å¤§çš„èƒ½é‡ï¼Œä¸ºå¤ªé˜³ç³»ä¸­çš„è¡Œæ˜Ÿæä¾›å…‰å’Œçƒ­ã€‚</p>
        </div>
        <div id="mercury-info" class="planet-info">
            <h2>â˜¿ æ°´æ˜Ÿ</h2>
            <p>æ°´æ˜Ÿæ˜¯ç¦»å¤ªé˜³æœ€è¿‘çš„è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯å¤ªé˜³ç³»ä¸­ä½“ç§¯å’Œè´¨é‡æœ€å°çš„è¡Œæ˜Ÿã€‚</p>
            <ul>
                <li>ç›´å¾„: 4,879 å…¬é‡Œ</li>
                <li>è´¨é‡: 3.3011 Ã— 10^23 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 88 å¤©</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 58.6 å¤©</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 5790ä¸‡å…¬é‡Œ</li>
                <li>è¡¨é¢æ¸©åº¦: -173Â°C è‡³ 427Â°C</li>
            </ul>
            <p>æ°´æ˜Ÿæ²¡æœ‰æ˜æ˜¾çš„å¤§æ°”å±‚ï¼Œè¡¨é¢æ»¡æ˜¯æ’å‡»å‘ï¼Œæ˜¼å¤œæ¸©å·®æå¤§ã€‚</p>
        </div>
        <div id="venus-info" class="planet-info">
            <h2>â™€ é‡‘æ˜Ÿ</h2>
            <p>é‡‘æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­ç¬¬äºŒé¢—è¡Œæ˜Ÿï¼Œå¤§å°ä¸åœ°çƒç›¸ä¼¼ï¼Œä½†ç¯å¢ƒæç«¯ã€‚</p>
            <ul>
                <li>ç›´å¾„: 12,104 å…¬é‡Œ</li>
                <li>è´¨é‡: 4.8675 Ã— 10^24 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 225 å¤©</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 243 å¤©ï¼ˆé€†è¡Œï¼‰</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 1.08äº¿å…¬é‡Œ</li>
                <li>è¡¨é¢æ¸©åº¦: çº¦ 462Â°C</li>
            </ul>
            <p>é‡‘æ˜Ÿè¢«åšåšçš„äºŒæ°§åŒ–ç¢³å¤§æ°”å±‚è¦†ç›–ï¼Œé€ æˆå¤±æ§çš„æ¸©å®¤æ•ˆåº”ï¼Œä½¿å…¶æˆä¸ºå¤ªé˜³ç³»ä¸­æœ€çƒ­çš„è¡Œæ˜Ÿã€‚</p>
        </div>
        <div id="earth-info" class="planet-info">
            <h2>ğŸŒ åœ°çƒ</h2>
            <p>åœ°çƒæ˜¯å¤ªé˜³ç³»ä¸­ç¬¬ä¸‰é¢—è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯ç›®å‰å·²çŸ¥å”¯ä¸€å­•è‚²ç”Ÿå‘½çš„å®¶å›­ã€‚</p>
            <ul>
                <li>ç›´å¾„: 12,742 å…¬é‡Œ</li>
                <li>è´¨é‡: 5.97237 Ã— 10^24 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 365.25 å¤©</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 23å°æ—¶ 56åˆ†</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 1.496äº¿å…¬é‡Œ</li>
                <li>å¹³å‡è¡¨é¢æ¸©åº¦: çº¦ 15Â°C</li>
                <li>å«æ˜Ÿ: 1ä¸ªï¼ˆæœˆçƒï¼‰</li>
            </ul>
            <p>åœ°çƒè¡¨é¢çš„71%è¢«æ¶²æ€æ°´è¦†ç›–ï¼Œæ‹¥æœ‰å¯Œå«æ°®æ°§çš„å¤§æ°”å±‚å’Œä¿æŠ¤æ€§çš„ç£åœºã€‚</p>
        </div>
        <div id="mars-info" class="planet-info">
            <h2>â™‚ ç«æ˜Ÿ</h2>
            <p>ç«æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­ç¬¬å››é¢—è¡Œæ˜Ÿï¼Œå¸¸è¢«ç§°ä¸º"çº¢è‰²æ˜Ÿçƒ"ã€‚</p>
            <ul>
                <li>ç›´å¾„: 6,779 å…¬é‡Œ</li>
                <li>è´¨é‡: 6.4171 Ã— 10^23 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 687 å¤©</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 24å°æ—¶ 37åˆ†</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 2.28äº¿å…¬é‡Œ</li>
                <li>è¡¨é¢æ¸©åº¦: -153Â°C è‡³ 20Â°C</li>
                <li>å«æ˜Ÿ: 2ä¸ªï¼ˆç«å«ä¸€ Phobos, ç«å«äºŒ Deimosï¼‰</li>
            </ul>
            <p>ç«æ˜Ÿè¡¨é¢æœ‰é«˜å±±ã€å³¡è°·å’Œæåœ°å†°ç›–ã€‚è¿‡å»å¯èƒ½å­˜åœ¨æ¶²æ€æ°´ï¼Œæ˜¯æ¢ç´¢ç”Ÿå‘½è¿¹è±¡çš„çƒ­ç‚¹ã€‚</p>
        </div>
        <div id="jupiter-info" class="planet-info">
            <h2>â™ƒ æœ¨æ˜Ÿ</h2>
            <p>æœ¨æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­æœ€å¤§çš„è¡Œæ˜Ÿï¼Œä¸€é¢—æ°”æ€å·¨è¡Œæ˜Ÿã€‚</p>
            <ul>
                <li>ç›´å¾„: 139,820 å…¬é‡Œ</li>
                <li>è´¨é‡: 1.8982 Ã— 10^27 å…¬æ–¤ (æ˜¯å…¶ä»–è¡Œæ˜Ÿæ€»å’Œçš„2.5å€)</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 11.86 å¹´</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 9å°æ—¶ 56åˆ† (æœ€å¿«)</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 7.79äº¿å…¬é‡Œ</li>
                <li>äº‘é¡¶æ¸©åº¦: çº¦ -145Â°C</li>
                <li>å·²çŸ¥å«æ˜Ÿ: 95+</li>
            </ul>
            <p>æœ¨æ˜Ÿä¸»è¦ç”±æ°¢å’Œæ°¦ç»„æˆï¼Œè‘—åç‰¹å¾æ˜¯å¤§çº¢æ–‘â€”â€”ä¸€ä¸ªå·¨å¤§çš„åæ°”æ—‹é£æš´ã€‚æ‹¥æœ‰å¼ºå¤§çš„ç£åœºå’Œä¼—å¤šå«æ˜Ÿã€‚</p>
        </div>
        <div id="saturn-info" class="planet-info">
            <h2>â™„ åœŸæ˜Ÿ</h2>
            <p>åœŸæ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­ç¬¬å…­é¢—è¡Œæ˜Ÿï¼Œä»¥å…¶å£®è§‚çš„ç¯ç³»ç»Ÿè‘—ç§°ã€‚</p>
            <ul>
                <li>ç›´å¾„: 116,460 å…¬é‡Œ</li>
                <li>è´¨é‡: 5.6834 Ã— 10^26 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 29.46 å¹´</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 10å°æ—¶ 33åˆ†</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 14.3äº¿å…¬é‡Œ</li>
                <li>äº‘é¡¶æ¸©åº¦: çº¦ -178Â°C</li>
                <li>å·²çŸ¥å«æ˜Ÿ: 146+ (åŒ…æ‹¬åœŸå«å…­ Titan)</li>
            </ul>
            <p>åœŸæ˜Ÿç¯ä¸»è¦ç”±å†°ç²’å’Œå°‘é‡å²©çŸ³ç¢ç‰‡ç»„æˆã€‚åœŸæ˜Ÿæœ¬èº«æ˜¯å¯†åº¦æœ€å°çš„è¡Œæ˜Ÿï¼Œæ¯”æ°´è¿˜è½»ã€‚</p>
        </div>
        <div id="uranus-info" class="planet-info">
            <h2>â›¢ å¤©ç‹æ˜Ÿ</h2>
            <p>å¤©ç‹æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­ç¬¬ä¸ƒé¢—è¡Œæ˜Ÿï¼Œä¸€é¢—å†°å·¨æ˜Ÿã€‚</p>
            <ul>
                <li>ç›´å¾„: 50,724 å…¬é‡Œ</li>
                <li>è´¨é‡: 8.6810 Ã— 10^25 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 84.01 å¹´</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 17å°æ—¶ 14åˆ† (é€†è¡Œ)</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 28.7äº¿å…¬é‡Œ</li>
                <li>äº‘é¡¶æ¸©åº¦: çº¦ -224Â°C (æœ€å†·)</li>
                <li>å·²çŸ¥å«æ˜Ÿ: 27+</li>
            </ul>
            <p>å¤©ç‹æ˜Ÿä»¥å…¶æç«¯çš„è½´å‘å€¾æ–œï¼ˆçº¦98åº¦ï¼‰è‘—ç§°ï¼Œå‡ ä¹æ˜¯"èººç€"ç»•å¤ªé˜³å…¬è½¬ã€‚å¤§æ°”ä¸­çš„ç”²çƒ·ä½¿å…¶å‘ˆç°è“ç»¿è‰²ã€‚</p>
        </div>
        <div id="neptune-info" class="planet-info">
            <h2>â™† æµ·ç‹æ˜Ÿ</h2>
            <p>æµ·ç‹æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­ç¬¬å…«é¢—ä¹Ÿæ˜¯æœ€è¿œçš„è¡Œæ˜Ÿï¼Œå¦ä¸€é¢—å†°å·¨æ˜Ÿã€‚</p>
            <ul>
                <li>ç›´å¾„: 49,244 å…¬é‡Œ</li>
                <li>è´¨é‡: 1.02413 Ã— 10^26 å…¬æ–¤</li>
                <li>è½¨é“å‘¨æœŸ: çº¦ 164.8 å¹´</li>
                <li>è‡ªè½¬å‘¨æœŸ: çº¦ 16å°æ—¶ 6åˆ†</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 45.0äº¿å…¬é‡Œ</li>
                <li>äº‘é¡¶æ¸©åº¦: çº¦ -218Â°C</li>
                <li>å·²çŸ¥å«æ˜Ÿ: 14+ (åŒ…æ‹¬æµ·å«ä¸€ Triton)</li>
            </ul>
            <p>æµ·ç‹æ˜Ÿæ˜¯ç¬¬ä¸€ä¸ªé€šè¿‡æ•°å­¦é¢„æµ‹å‘ç°çš„è¡Œæ˜Ÿã€‚æ‹¥æœ‰å¤ªé˜³ç³»ä¸­æœ€å¼ºçš„é£ï¼Œé€Ÿåº¦å¯è¾¾2100å…¬é‡Œ/å°æ—¶ã€‚</p>
        </div>
        <div id="asteroid-belt-info" class="planet-info">
            <h2>ğŸª¨ å°è¡Œæ˜Ÿå¸¦</h2>
            <p>å°è¡Œæ˜Ÿå¸¦æ˜¯ä½äºç«æ˜Ÿå’Œæœ¨æ˜Ÿè½¨é“ä¹‹é—´çš„ä¸€ä¸ªåŒºåŸŸï¼Œç”±æ•°ç™¾ä¸‡é¢—å²©è´¨å¤©ä½“ç»„æˆã€‚</p>
            <ul>
                <li>ä½ç½®: ç«æ˜Ÿå’Œæœ¨æ˜Ÿè½¨é“ä¹‹é—´</li>
                <li>å¹³å‡è·ç¦»å¤ªé˜³: 2.2-3.2 AU (3.3-4.8äº¿å…¬é‡Œ)</li>
                <li>å·²çŸ¥å°è¡Œæ˜Ÿæ•°é‡: 100ä¸‡+</li>
                <li>æœ€å¤§æˆå‘˜: è°·ç¥æ˜Ÿ (ç›´å¾„çº¦940å…¬é‡Œ)</li>
            </ul>
            <p>å°è¡Œæ˜Ÿå¸¦è¢«è®¤ä¸ºæ˜¯å¤ªé˜³ç³»å½¢æˆæ—©æœŸï¼Œç”±äºæœ¨æ˜Ÿå¼ºå¤§å¼•åŠ›çš„å¹²æ‰°è€Œæœªèƒ½å‡èšæˆè¡Œæ˜Ÿçš„ç‰©è´¨æ®‹éª¸ã€‚</p>
        </div>
    </div>

    <!-- é”®ç›˜å¿«æ·é”®æç¤º -->
    <div class="keyboard-shortcuts">
        <h3>âŒ¨ï¸ é”®ç›˜å¿«æ·é”®</h3>
        <ul>
            <li><kbd>ç©ºæ ¼</kbd>: æš‚åœ/ç»§ç»­</li>
            <li><kbd>R</kbd>: é‡ç½®</li>
            <li><kbd>L</kbd>: åˆ‡æ¢æ ‡ç­¾</li>
            <li><kbd>T</kbd>: åˆ‡æ¢è½¨è¿¹</li>
            <li><kbd>I</kbd>: åˆ‡æ¢ä¿¡æ¯é¢æ¿</li>
            <li><kbd>A</kbd>: åˆ‡æ¢å°è¡Œæ˜Ÿå¸¦</li>
            <li><kbd>G</kbd>: åˆ‡æ¢å‘å…‰æ•ˆæœ</li>
            <li><kbd>F</kbd>: å…¨å±æ¨¡å¼</li>
            <li><kbd>+/-</kbd>: è°ƒæ•´é€Ÿåº¦</li>
            <li><kbd>é¼ æ ‡æ»šè½®</kbd>: ç¼©æ”¾</li>
        </ul>
    </div>
    <script>
        // ä½¿ç”¨å¤šä¸ªJavaScriptåº“
        
        // å…¨å±€å˜é‡å’Œé…ç½®
        const canvas = document.getElementById('solar-system');
        const ctx = canvas.getContext('2d');
        const simulationContainer = document.getElementById('simulation-container');
        const infoPanel = document.getElementById('info-panel');
        const introContent = document.getElementById('intro-content');
        const infoToggleBtn = document.getElementById('info-toggle-btn');
        const allPlanetInfoDivs = document.querySelectorAll('.planet-info');
        const toggleLabelsBtn = document.getElementById('toggle-labels-btn');
        const toggleTrailsBtn = document.getElementById('toggle-trails-btn');
        const zoomValueDisplay = document.getElementById('zoom-value-display');
        const asteroidInfoDiv = document.getElementById('asteroid-info');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsPopup = document.getElementById('settings-popup');
        const settingsCloseBtn = document.getElementById('settings-close-btn');
        const loadingScreen = document.getElementById('loading-screen');

        // Stats.js æ€§èƒ½ç›‘æ§
        const stats = new Stats();
        stats.showPanel(0);
        document.body.appendChild(stats.dom);
        stats.dom.id = 'stats';

        // GSAP åŠ¨ç”»é…ç½®
        gsap.config({
            force3D: true,
            autoSleep: 60
        });

        // æ–°å¢åŠŸèƒ½å˜é‡
        let particleSystem = null;
        let glowEffectEnabled = true;
        let qualityMultiplier = 1;
        let gui = null;

        // Hammer.js è§¦æ‘¸æ‰‹åŠ¿
        const hammertime = new Hammer(simulationContainer);
        hammertime.get('pinch').set({ enable: true });
        hammertime.get('pan').set({ direction: Hammer.DIRECTION_ALL });

        // è®¾ç½®ç”»å¸ƒå°ºå¯¸
        function resizeCanvas() {
            const dpr = Math.min(window.devicePixelRatio || 1, qualityMultiplier * 2);
            
            canvas.width = simulationContainer.clientWidth * dpr;
            canvas.height = simulationContainer.clientHeight * dpr;
            
            canvas.style.width = `${simulationContainer.clientWidth}px`;
            canvas.style.height = `${simulationContainer.clientHeight}px`;
            
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.scale(dpr, dpr);
            
            // ä½¿ç”¨GSAPæ›´æ–°ä¸­å¿ƒç‚¹åŠ¨ç”»
            gsap.set(canvas, { 
                filter: glowEffectEnabled ? 'drop-shadow(0 0 20px rgba(255, 255, 255, 0.3))' : 'none' 
            });
            
            baseX = simulationContainer.clientWidth / 2;
            baseY = simulationContainer.clientHeight / 2;
            
            if (offsetX === 0 && offsetY === 0) {
                offsetX = defaultOffsetX;
                offsetY = defaultOffsetY;
            }
            
            centerX = baseX + offsetX;
            centerY = baseY + offsetY;
            
            planets.forEach(planet => {
                if (planet.name !== "sun") {
                    planet.trail = [];
                }
            });
            
            createLabels();
            stars = generateStarfield();
            updateZoomValueDisplay();
            
            // æ›´æ–°ç²’å­ç³»ç»Ÿ
            if (particleSystem) {
                particleSystem.resize();
            }
        }

        window.addEventListener('resize', resizeCanvas);

        // å¤ªé˜³ç³»å‚æ•° 
        const planets = [
            { name: "sun", color: "FDB813", radius: 35, distance: 0, orbit: 0, speed: 0, rotationSpeed: 0.5, angle: 0, rotationAngle: 0, moons: [], rings: false, showTrail: false, trail: [] },
            { name: "mercury", color: "B7B8B9", radius: 4, distance: 60, orbit: 88, speed: 0.041, rotationSpeed: 0.02, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
            { name: "venus", color: "E7CDCD", radius: 8, distance: 90, orbit: 225, speed: 0.016, rotationSpeed: 0.004, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [], rings: false, showTrail: false, trail: [], trailMaxPoints: 100 },
            {
                name: "earth", color: "267bef", radius: 9, distance: 130, orbit: 365, speed: 0.01, rotationSpeed: 0.5, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [
                    { name: "moon", distance: 15, radius: 2, orbit: 27, angle: 0, speed: 0.1 }
                ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100
            },
            {
                name: "mars", color: "c1440e", radius: 6, distance: 180, orbit: 687, speed: 0.0053, rotationSpeed: 0.48, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [
                    { name: "phobos", distance: 10, radius: 1, orbit: 0.3, angle: 0, speed: 0.2 },
                    { name: "deimos", distance: 14, radius: 1, orbit: 1.2, angle: Math.PI, speed: 0.15 }
                ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100
            },
            {
                name: "jupiter", color: "e0b44e", radius: 25, distance: 280, orbit: 4333, speed: 0.0008, rotationSpeed: 1.2, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [
                    { name: "io", distance: 35, radius: 2, orbit: 1.7, angle: 0, speed: 0.05 },
                    { name: "europa", distance: 40, radius: 2, orbit: 3.5, angle: Math.PI / 2, speed: 0.04 },
                    { name: "ganymede", distance: 45, radius: 3, orbit: 7.1, angle: Math.PI, speed: 0.03 },
                    { name: "callisto", distance: 55, radius: 3, orbit: 16.7, angle: Math.PI * 1.5, speed: 0.02 }
                ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100
            },
            {
                name: "saturn", color: "f4d4a9", radius: 20, distance: 380, orbit: 10759, speed: 0.0003, rotationSpeed: 1.1, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [
                    { name: "titan", distance: 35, radius: 3, orbit: 16, angle: Math.PI / 3, speed: 0.04 }
                ], rings: true, ringColor: "f4ebd2", ringInner: 25, ringOuter: 40, showTrail: false, trail: [], trailMaxPoints: 100
            },
            {
                name: "uranus", color: "BAFFFA", radius: 15, distance: 480, orbit: 30687, speed: 0.0001, rotationSpeed: 0.7, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [
                    { name: "miranda", distance: 22, radius: 1, orbit: 1.4, angle: Math.PI * 1.2, speed: 0.03 }
                ], rings: true, ringColor: "e0faf8", ringInner: 18, ringOuter: 22, showTrail: false, trail: [], trailMaxPoints: 100
            },
            {
                name: "neptune", color: "5B5DDF", radius: 14, distance: 580, orbit: 60190, speed: 0.00006, rotationSpeed: 0.8, angle: Math.random() * Math.PI * 2, rotationAngle: 0, moons: [
                    { name: "triton", distance: 25, radius: 2, orbit: 5.8, angle: Math.PI * 0.8, speed: 0.02 }
                ], rings: false, showTrail: false, trail: [], trailMaxPoints: 100
            }
        ];

        // å°è¡Œæ˜Ÿå¸¦
        let showAsteroidBelt = false;
        let asteroids = [];

        // ç”Ÿæˆå°è¡Œæ˜Ÿå¸¦ - ä½¿ç”¨GSAPä¼˜åŒ–
        function generateAsteroidBelt() {
            asteroids = [];
            const asteroidCount = 800;
            const minDistance = 200;
            const maxDistance = 260;
            const minSize = 0.5;
            const maxSize = 2;
            
            for (let i = 0; i < asteroidCount; i++) {
                const distance = minDistance + Math.random() * (maxDistance - minDistance);
                const angle = Math.random() * Math.PI * 2;
                const size = minSize + Math.random() * (maxSize - minSize);
                const baseSpeed = 0.002;
                const speedVariation = 0.0005;
                const speed = baseSpeed + (Math.random() * 2 - 1) * speedVariation;
                const grayValue = Math.floor(Math.random() * 100 + 155).toString(16);
                const color = grayValue + grayValue + grayValue;
                
                asteroids.push({
                    distance,
                    angle,
                    size,
                    speed,
                    color,
                    opacity: 0.7 + Math.random() * 0.3 // éšæœºé€æ˜åº¦
                });
            }
        }

        // æ§åˆ¶æ¨¡æ‹Ÿå‚æ•°
        let paused = false;
        let speed = 0.01;
        let zoom = 1;
        let baseX, baseY;
        let defaultOffsetX = -150;
        let defaultOffsetY = -300;
        let offsetX = defaultOffsetX, offsetY = defaultOffsetY;
        let centerX, centerY;
        let planetLabels = [];
        let showLabels = true;
        let infoPanelVisible = true;
        let planetScreenData = [];
        let stars = [];

        // æ‹–åŠ¨ç›¸å…³å˜é‡
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let lastOffsetX = 0;
        let lastOffsetY = 0;

        // ç¼©æ”¾ç›¸å…³å˜é‡
        let zoomMin = 0.2;
        let zoomMax = 200;
        let zoomStep = 0.2;

        // å¤šç‚¹è§¦æ§ç›¸å…³å˜é‡
        let touchDistance = 0;
        let touchZoomStartScale = 1;

        // ç²’å­ç³»ç»Ÿç±»
        class ParticleSystem {
            constructor() {
                this.particles = [];
                this.maxParticles = 150;
                this.init();
            }

            init() {
                for (let i = 0; i < this.maxParticles; i++) {
                    this.particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        radius: Math.random() * 2 + 0.5,
                        opacity: Math.random() * 0.6 + 0.2,
                        life: Math.random() * 100 + 50
                    });
                }
            }

            update() {
                this.particles.forEach(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life--;
                    
                    if (particle.life <= 0 || 
                        particle.x < 0 || particle.x > canvas.width ||
                        particle.y < 0 || particle.y > canvas.height) {
                        particle.x = Math.random() * canvas.width;
                        particle.y = Math.random() * canvas.height;
                        particle.life = Math.random() * 100 + 50;
                    }
                });
            }

            draw() {
                ctx.save();
                this.particles.forEach(particle => {
                    ctx.globalAlpha = particle.opacity * (particle.life / 100);
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fillStyle = '#ffffff';
                    ctx.fill();
                });
                ctx.restore();
            }

            resize() {
                this.particles.forEach(particle => {
                    if (particle.x > canvas.width) particle.x = canvas.width;
                    if (particle.y > canvas.height) particle.y = canvas.height;
                });
            }
        }

        // éŸ³é¢‘ç®¡ç†
        class AudioManager {
            constructor() {
                this.audioContext = null;
                this.clickSoundEnabled = true; // ç‚¹å‡»éŸ³æ•ˆé»˜è®¤ä¸ºå¼€å¯çŠ¶æ€
                this.clickSoundToggleBtn = null; // ç”¨äºå­˜å‚¨æŒ‰é’®å…ƒç´ çš„å¼•ç”¨
            }

            init() {
                // è·å–æ§åˆ¶æŒ‰é’®
                this.clickSoundToggleBtn = document.getElementById('click-sound-toggle');

                // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                try {
                    if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } else {
                        console.warn("Web Audio API is not supported. Click sounds will be disabled.");
                        this.clickSoundEnabled = false;
                        if (this.clickSoundToggleBtn) this.clickSoundToggleBtn.disabled = true; // ç¦ç”¨æŒ‰é’®
                    }
                } catch (e) {
                    console.error("Error initializing AudioContext:", e);
                    this.clickSoundEnabled = false;
                    if (this.clickSoundToggleBtn) this.clickSoundToggleBtn.disabled = true; // ç¦ç”¨æŒ‰é’®
                }
                
                this.updateButtonText(); // åˆå§‹åŒ–æŒ‰é’®æ–‡æœ¬

                // ä¸ºæŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                if (this.clickSoundToggleBtn) {
                    this.clickSoundToggleBtn.addEventListener('click', () => this.toggleClickSound());
                }
            }

            toggleClickSound() {
                if (!this.audioContext && !this.clickSoundEnabled) return; // å¦‚æœWebAudioAPIä¸æ”¯æŒä¸”å·²ç¦ç”¨ï¼Œåˆ™ä¸æ“ä½œ

                this.clickSoundEnabled = !this.clickSoundEnabled;
                this.updateButtonText();

                // æ’­æ”¾ä¸€ä¸ªè½»å¾®çš„æç¤ºéŸ³è¡¨ç¤ºçŠ¶æ€åˆ‡æ¢
                if (this.audioContext) {
                    this.playSimpleTone(this.clickSoundEnabled ? 600 : 440, 0.02, 0.05);
                }
            }
            
            updateButtonText() {
                if (this.clickSoundToggleBtn) {
                    this.clickSoundToggleBtn.textContent = this.clickSoundEnabled ? 'ğŸ”Š ç‚¹å‡»éŸ³æ•ˆ: å¼€' : 'ğŸ”‡ ç‚¹å‡»éŸ³æ•ˆ: å…³';
                }
            }

            playClickSound() {
                if (!this.clickSoundEnabled || !this.audioContext) {
                    return;
                }
                
                // å‚æ•°: é¢‘ç‡ (Hz), éŸ³é‡ (0.0-1.0), æŒç»­æ—¶é—´ (ç§’)
                this.playSimpleTone(880, 0.03, 0.05); 
            }

            // è¾…åŠ©å‡½æ•°ï¼šæ’­æ”¾ä¸€ä¸ªç®€å•çš„éŸ³è°ƒ
            playSimpleTone(frequency, volume, duration) {
                if (!this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.type = 'sine'; // 'sine' æ³¢å½¢æ¯”è¾ƒæŸ”å’Œ
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                
                // éŸ³é‡åŒ…ç»œï¼šå¿«é€Ÿèµ·éŸ³ï¼Œå¿«é€Ÿè¡°å‡
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.005); // å¿«é€Ÿèµ·éŸ³
                gainNode.gain.exponentialRampToValueAtTime(0.0001, this.audioContext.currentTime + duration);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
        }

        const audioManager = new AudioManager();

        // æ˜Ÿç©ºèƒŒæ™¯ç”Ÿæˆå‡½æ•°
        function generateStarfield() {
            const stars = [];
            const starCount = 300;
            const bufferFactor = 3;
            const width = canvas.width * bufferFactor;
            const height = canvas.height * bufferFactor;
            const offsetX = -width / 2 + canvas.width / 2;
            const offsetY = -height / 2 + canvas.height / 2;

            for (let i = 0; i < starCount; i++) {
                const starTypes = [
                    `hsl(${Math.random() * 20 + 200}, 60%, ${Math.random() * 25 + 75}%)`, // è“ç™½è‰²æ’æ˜Ÿ
                    `hsl(${Math.random() * 30 + 50}, 50%, ${Math.random() * 20 + 80}%)`,  // é»„ç™½è‰²æ’æ˜Ÿ
                    `hsl(${Math.random() * 20 + 25}, 70%, ${Math.random() * 25 + 70}%)`,  // æ©™è‰²æ’æ˜Ÿ
                    `hsl(${Math.random() * 10 + 0}, 80%, ${Math.random() * 20 + 75}%)`,   // çº¢è‰²æ’æ˜Ÿ
                    `hsl(0, 0%, ${Math.random() * 20 + 80}%)`                             // ç™½è‰²æ’æ˜Ÿ
                ];
                const randomColorIndex = Math.floor(Math.random() * starTypes.length);
                
                stars.push({
                    x: offsetX + Math.random() * width,
                    y: offsetY + Math.random() * height,
                    radius: Math.random() * 1.5 + 0.5,
                    opacity: Math.random() * 0.8 + 0.2,
                    twinkleSpeed: Math.random() * 0.01 + 0.001,
                    twinkleOffset: Math.random() * Math.PI * 2,
                    color: starTypes[randomColorIndex]
                });
            }

            // æ·»åŠ æ˜Ÿäº‘
            const nebulaeCount = 5;
            for (let i = 0; i < nebulaeCount; i++) {
                const nebulaColors = [
                    `rgba(${Math.floor(Math.random() * 50 + 80)}, 30, ${Math.floor(Math.random() * 50 + 100)}, 0.08)`,   // ç´«çº¢è‰²æ˜Ÿäº‘
                    `rgba(40, ${Math.floor(Math.random() * 40 + 80)}, ${Math.floor(Math.random() * 30 + 120)}, 0.06)`,   // è“ç»¿è‰²æ˜Ÿäº‘
                    `rgba(${Math.floor(Math.random() * 40 + 100)}, ${Math.floor(Math.random() * 30 + 60)}, 30, 0.07)`,   // æ©™çº¢è‰²æ˜Ÿäº‘
                    `rgba(60, 60, ${Math.floor(Math.random() * 40 + 80)}, 0.05)`,                                         // æ·¡è“è‰²æ˜Ÿäº‘
                    `rgba(${Math.floor(Math.random() * 30 + 70)}, ${Math.floor(Math.random() * 30 + 70)}, 50, 0.06)`    // æ·¡é»„è‰²æ˜Ÿäº‘
                ];
                
                stars.push({
                    type: 'nebula',
                    x: offsetX + Math.random() * width,
                    y: offsetY + Math.random() * height,
                    radius: Math.random() * 150 + 80,
                    color: nebulaColors[i % nebulaColors.length],
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.001
                });
            }

            return stars;
        }

        // æ˜Ÿç©ºç»˜åˆ¶å‡½æ•°
        function drawStarfield() {
            const viewOffsetX = (offsetX / zoom);
            const viewOffsetY = (offsetY / zoom);
            
            stars.forEach(star => {
                const adjustedX = star.x + viewOffsetX * 0.2;
                const adjustedY = star.y + viewOffsetY * 0.2;
                
                const visibleWidth = canvas.width * 1.5;
                const visibleHeight = canvas.height * 1.5;
                const visibleOffsetX = (centerX - canvas.width / 2);
                const visibleOffsetY = (centerY - canvas.height / 2);
                
                let displayX = ((adjustedX - visibleOffsetX) % visibleWidth + visibleWidth) % visibleWidth + visibleOffsetX;
                let displayY = ((adjustedY - visibleOffsetY) % visibleHeight + visibleHeight) % visibleHeight + visibleOffsetY;

                if (star.type === 'nebula') {
                    // æ›´æ–°æ˜Ÿäº‘æ—‹è½¬
                    star.rotation += star.rotationSpeed;
                    
                    ctx.save();
                    ctx.translate(displayX, displayY);
                    ctx.rotate(star.rotation);
                    
                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, star.radius * zoom);
                    gradient.addColorStop(0, star.color.replace('0.1', '0.3'));
                    gradient.addColorStop(0.5, star.color);
                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    
                    ctx.beginPath();
                    ctx.moveTo(star.radius * zoom * 0.5, 0);
                    for (let i = 1; i < 12; i++) {
                        const angle = (i / 12) * Math.PI * 2;
                        const radiusScaled = star.radius * zoom * (0.5 + Math.sin(i * 5) * 0.5);
                        ctx.lineTo(
                            Math.cos(angle) * radiusScaled,
                            Math.sin(angle) * radiusScaled
                        );
                    }
                    ctx.closePath();
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    ctx.restore();
                } else {
                    // æ˜Ÿæ˜Ÿé—ªçƒæ•ˆæœ
                    const twinkle = Math.sin(Date.now() * star.twinkleSpeed + star.twinkleOffset) * 0.3 + 0.7;
                    const glowSize = glowEffectEnabled ? star.radius * zoom * 2 : 0;
                    
                    if (glowEffectEnabled && glowSize > 0) {
                        ctx.save();
                        ctx.globalAlpha = star.opacity * twinkle * 0.3;
                        ctx.beginPath();
                        ctx.arc(displayX, displayY, glowSize, 0, Math.PI * 2);
                        ctx.fillStyle = star.color || 'white';
                        ctx.fill();
                        ctx.restore();
                    }
                    
                    ctx.save();
                    ctx.globalAlpha = star.opacity * twinkle;
                    ctx.beginPath();
                    ctx.arc(displayX, displayY, star.radius * zoom, 0, Math.PI * 2);
                    ctx.fillStyle = star.color || 'white';
                    ctx.fill();
                    ctx.restore();
                }
            });
        }

        // æ›´æ–°ä½ç½®å‡½æ•°
        function updatePositions(timeScale) {
            planets.forEach(planet => {
                if (!paused && timeScale > 0) {
                    if (planet.speed > 0) {
                        planet.angle += (planet.speed * speed * timeScale);
                        planet.angle %= (Math.PI * 2);
                        planet.rotationAngle += (planet.rotationSpeed * speed * timeScale);
                        planet.rotationAngle %= (Math.PI * 2);

                        if (planet.showTrail && planet.name !== "sun") {
                            const x = centerX + planet.distance * Math.cos(planet.angle) * zoom;
                            const y = centerY + planet.distance * Math.sin(planet.angle) * zoom;
                            
                            if (planet.trail.length === 0 ||
                                Math.hypot(x - planet.trail[planet.trail.length - 1].x,
                                    y - planet.trail[planet.trail.length - 1].y) > 5) {
                                planet.trail.push({ x, y });
                                if (planet.trail.length > planet.trailMaxPoints) {
                                    planet.trail.shift();
                                }
                            }
                        }
                    }

                    if (planet.moons && Array.isArray(planet.moons)) {
                        planet.moons.forEach(moon => {
                            if (moon.speed > 0) {
                                moon.angle += (moon.speed * speed * timeScale * 5);
                                moon.angle %= (Math.PI * 2);
                            }
                        });
                    }
                }
            });

            if (showAsteroidBelt && !paused && timeScale > 0) {
                asteroids.forEach(asteroid => {
                    asteroid.angle += (asteroid.speed * speed * timeScale);
                    asteroid.angle %= (Math.PI * 2);
                });
            }
        }

        // å°è¡Œæ˜Ÿå¸¦ç»˜åˆ¶
        function drawAsteroidBelt() {
            if (!showAsteroidBelt) return;
            
            ctx.save();
            asteroids.forEach(asteroid => {
                const x = centerX + asteroid.distance * Math.cos(asteroid.angle) * zoom;
                const y = centerY + asteroid.distance * Math.sin(asteroid.angle) * zoom;
                const size = asteroid.size * zoom;

                if (x >= -size && x <= canvas.width + size &&
                    y >= -size && y <= canvas.height + size) {
                    
                    ctx.globalAlpha = asteroid.opacity;
                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fillStyle = `#${asteroid.color}`;
                    ctx.fill();
                    
                    // æ·»åŠ å‘å…‰æ•ˆæœ
                    if (glowEffectEnabled) {
                        ctx.globalAlpha = asteroid.opacity * 0.3;
                        ctx.beginPath();
                        ctx.arc(x, y, size * 2, 0, Math.PI * 2);
                        ctx.fillStyle = `#${asteroid.color}`;
                        ctx.fill();
                    }
                }
            });
            ctx.restore();
        }

        // å¤©ä½“ç»˜åˆ¶å‡½æ•°ï¼ˆå¤ªé•¿äº†ï¼Œè¿™é‡Œä¿æŒåŸæ ·ï¼‰
        function drawCelestialBody(planet) {
            const x = centerX + planet.distance * Math.cos(planet.angle) * zoom;
            const y = centerY + planet.distance * Math.sin(planet.angle) * zoom;
            const radius = planet.radius * zoom;

            // ç»˜åˆ¶è½¨è¿¹ - ä½¿ç”¨GSAPä¼˜åŒ–
            if (planet.showTrail && planet.trail.length > 1 && planet.name !== "sun") {
                ctx.save();
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                ctx.moveTo(planet.trail[0].x, planet.trail[0].y);
                for (let i = 1; i < planet.trail.length; i++) {
                    ctx.lineTo(planet.trail[i].x, planet.trail[i].y);
                }
                ctx.strokeStyle = `#${planet.color}`;
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.restore();
            }

            // ç»˜åˆ¶è½¨é“
            if (planet.distance > 0 && planet.name !== "sun") {
                const orbitSegments = 36;
                const angleStep = (Math.PI * 2) / orbitSegments;
                
                for (let i = 0; i < orbitSegments; i++) {
                    const startAngle = i * angleStep;
                    const endAngle = (i + 1) * angleStep;
                    const segmentMidAngle = startAngle + angleStep / 2;
                    const angleDiffFromPlanet = Math.abs(segmentMidAngle - planet.angle);
                    const brightness = 0.08 + (0.22 * (Math.cos(angleDiffFromPlanet) + 1) / 2);
                    
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, planet.distance * zoom, startAngle, endAngle);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${brightness})`;
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }

            // æ ¹æ®è¡Œæ˜Ÿç±»å‹ç»˜åˆ¶ - è¯¦ç»†ç»˜åˆ¶é€»è¾‘
            if (planet.name === "sun") {
                ctx.save();
                
                // å¤ªé˜³æ•ˆæœ
                const outerGlowRadius = radius * (glowEffectEnabled ? 3 : 2.5);
                const outerGlow = ctx.createRadialGradient(
                    x, y, radius * 0.8,
                    x, y, outerGlowRadius
                );
                outerGlow.addColorStop(0, "rgba(255, 220, 100, 0.4)");
                outerGlow.addColorStop(0.3, "rgba(255, 150, 50, 0.25)");
                outerGlow.addColorStop(0.6, "rgba(255, 80, 20, 0.15)");
                outerGlow.addColorStop(1, "rgba(255, 30, 0, 0)");
                
                ctx.beginPath();
                ctx.arc(x, y, outerGlowRadius, 0, Math.PI * 2);
                ctx.fillStyle = outerGlow;
                ctx.fill();

                // å¤ªé˜³ä¸»ä½“
                const sunGradient = ctx.createRadialGradient(
                    x - radius * 0.25, y - radius * 0.25, radius * 0.05,
                    x, y, radius
                );
                sunGradient.addColorStop(0, "#FFFFFF");
                sunGradient.addColorStop(0.2, "#FFFFA0");
                sunGradient.addColorStop(0.5, "#FFDD00");
                sunGradient.addColorStop(0.8, "#FF9500");
                sunGradient.addColorStop(0.95, "#FF5500");
                sunGradient.addColorStop(1, "#FF3000");
                
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = sunGradient;
                ctx.fill();

                // åŠ¨æ€è€€æ–‘æ•ˆæœ
                const time = Date.now() * 0.0001 + planet.rotationAngle; // è‡ªè½¬æ—¶é—´å› å­

                // è£å‰ªåˆ°å¤ªé˜³è¡¨é¢
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(time * 0.5); // è‡ªè½¬é€Ÿåº¦å‡æ…¢ï¼Œæ›´è‡ªç„¶

                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();

                // 5. å¤ªé˜³è¡¨é¢ç­‰ç¦»å­ä½“å¯¹æµæ•ˆæœ - æ¨¡æ‹Ÿå¤ªé˜³è¡¨é¢çš„å¯¹æµå•å…ƒ
                const cellCount = 12; // å¢åŠ æ ¼å­æ•°é‡
                const cellSize = radius * 1.5 / cellCount;

                // ç»˜åˆ¶å¯¹æµå•å…ƒç½‘æ ¼
                for (let i = -cellCount; i < cellCount; i++) {
                    for (let j = -cellCount; j < cellCount; j++) {
                        const cellX = i * cellSize;
                        const cellY = j * cellSize;
                        const distFromCenter = Math.sqrt(cellX * cellX + cellY * cellY);

                        // åªåœ¨å¤ªé˜³è¡¨é¢å†…éƒ¨ç»˜åˆ¶
                        if (distFromCenter < radius * 0.95) {
                            const noise = Math.sin(i * 0.5 + time * 5) * Math.cos(j * 0.5 + time * 3) * 0.5 + 0.5;
                            const cellGradient = ctx.createRadialGradient(
                                cellX, cellY, 0,
                                cellX, cellY, cellSize * (0.8 + noise * 0.4)
                            );

                            // æ ¹æ®åˆ°ä¸­å¿ƒçš„è·ç¦»è°ƒæ•´é¢œè‰²
                            const brightness = 1 - (distFromCenter / radius) * 0.5;
                            const r = Math.floor(255 * brightness);
                            const g = Math.floor((180 + noise * 50) * brightness);
                            const b = Math.floor(noise * 50 * brightness);

                            cellGradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, 0.8)`);
                            cellGradient.addColorStop(0.7, `rgba(${r - 40}, ${g - 60}, ${b}, 0.2)`);
                            cellGradient.addColorStop(1, "rgba(255, 100, 0, 0)");

                            ctx.beginPath();
                            ctx.arc(cellX, cellY, cellSize * (0.5 + noise * 0.5), 0, Math.PI * 2);
                            ctx.fillStyle = cellGradient;
                            ctx.fill();
                        }
                    }
                }

                // 6. ä¼˜åŒ–å¤ªé˜³é»‘å­æ•ˆæœ - æ›´é€¼çœŸçš„é»‘å­
                const spotsCount = 8; // å¢åŠ é»‘å­æ•°é‡
                for (let i = 0; i < spotsCount; i++) {
                    // æ ¹æ®ç´¢å¼•è°ƒæ•´è§’åº¦ï¼Œä½¿é»‘å­åˆ†å¸ƒæ›´å‡åŒ€
                    const angleOffset = (Math.PI * 2) / spotsCount;
                    const angle = (i * angleOffset) + Math.sin(time * 3) * 0.2;

                    // éšæ—¶é—´å˜åŒ–çš„éçº¿æ€§è·ç¦»
                    const variation = Math.sin(time * 2 + i * 1.4) * 0.25;
                    const dist = radius * (0.3 + variation * 0.5 + i * 0.05) % radius;

                    // é»‘å­å¤§å°éšè·ç¦»å’Œæ—¶é—´å˜åŒ–
                    const spotSize = radius * (0.08 + Math.abs(variation) * 0.07);
                    const spotX = Math.cos(angle) * dist;
                    const spotY = Math.sin(angle) * dist;

                    // é»‘å­æœ‰æ›´å¤æ‚çš„ç»“æ„ - æœ¬å½±å’ŒåŠå½±
                    // é»‘å­æœ¬å½±
                    const umbra = ctx.createRadialGradient(
                        spotX, spotY, 0,
                        spotX, spotY, spotSize
                    );
                    umbra.addColorStop(0, "rgba(10, 0, 0, 0.95)");
                    umbra.addColorStop(0.5, "rgba(30, 5, 0, 0.9)");
                    umbra.addColorStop(0.7, "rgba(60, 15, 0, 0.7)");
                    umbra.addColorStop(1, "rgba(120, 40, 0, 0)");

                    ctx.beginPath();
                    ctx.arc(spotX, spotY, spotSize, 0, Math.PI * 2);
                    ctx.fillStyle = umbra;
                    ctx.fill();

                    // é»‘å­åŠå½± - å‘¨å›´çš„çº¤ç»´ç»“æ„
                    const penumbraSize = spotSize * 1.8;
                    ctx.strokeStyle = "rgba(180, 60, 0, 0.15)";

                    // ç»˜åˆ¶æ”¾å°„çŠ¶çº¤ç»´
                    for (let j = 0; j < 12; j++) {
                        const fiberAngle = (j / 12) * Math.PI * 2;
                        const fiberLength = penumbraSize * (0.8 + Math.random() * 0.4);

                        ctx.beginPath();
                        ctx.moveTo(
                            spotX + Math.cos(fiberAngle) * spotSize * 0.7,
                            spotY + Math.sin(fiberAngle) * spotSize * 0.7
                        );

                        // ä½¿ç”¨äºŒæ¬¡è´å¡å°”æ›²çº¿ç»˜åˆ¶å¼¯æ›²çš„çº¤ç»´
                        const cpDist = spotSize * 1.2;
                        const cpAngleOffset = Math.sin(time * 5 + j) * 0.2;

                        ctx.quadraticCurveTo(
                            spotX + Math.cos(fiberAngle + cpAngleOffset) * cpDist,
                            spotY + Math.sin(fiberAngle + cpAngleOffset) * cpDist,
                            spotX + Math.cos(fiberAngle) * fiberLength,
                            spotY + Math.sin(fiberAngle) * fiberLength
                        );

                        ctx.lineWidth = spotSize * 0.1;
                        ctx.stroke();
                    }
                }

                // æ¢å¤å¤ªé˜³è¡¨é¢è£å‰ª
                ctx.restore();

                // 7. å¤ªé˜³è€€æ–‘ - å…¨æ–°è®¾è®¡ï¼Œæ›´è‡ªç„¶çš„æ›²çº¿å’ŒåŠ¨æ€å˜åŒ–
                const flareCount = 9; // å¢åŠ è€€æ–‘æ•°é‡
                for (let i = 0; i < flareCount; i++) {
                    // éå‡åŒ€åˆ†å¸ƒçš„è€€æ–‘è§’åº¦
                    const flareAngle = (i / flareCount) * Math.PI * 2 + Math.sin(time * 3 + i) * 0.2;
                    const flareTime = time * 8 + i * 2.5;
                    // è€€æ–‘å¤§å°éšæ—¶é—´å˜åŒ–
                    const flareIntensity = 0.6 + Math.sin(flareTime * 0.5) * 0.4;
                    const flareSize = radius * (0.6 + Math.sin(flareTime) * 0.3) * flareIntensity;

                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(flareAngle);

                    // ä½¿ç”¨ä¸‰æ¬¡è´å¡å°”æ›²çº¿ç»˜åˆ¶æ›´å¤æ‚çš„è€€æ–‘å½¢çŠ¶
                    ctx.beginPath();
                    ctx.moveTo(radius * 0.92, 0);

                    // å¤æ‚çš„æ§åˆ¶ç‚¹è®¡ç®—ï¼Œä½¿è€€æ–‘çœ‹èµ·æ¥æ›´è‡ªç„¶ä¸”åŠ¨æ€
                    const cp1x = radius * (1.1 + Math.sin(flareTime * 0.3) * 0.1);
                    const cp1y = radius * 0.4 * Math.sin(flareTime * 0.7);

                    const cp2x = radius * (1.4 + Math.cos(flareTime * 0.5) * 0.15);
                    const cp2y = radius * 0.25 * Math.sin(flareTime * 0.9);

                    const cp3x = radius * (1.6 + Math.sin(flareTime * 0.4) * 0.2);
                    const cp3y = radius * 0.15 * Math.sin(flareTime * 1.1);

                    const endX = radius * (1.4 + Math.sin(flareTime * 0.3) * 0.3) * flareIntensity;
                    const endY = 0;

                    // ä½¿ç”¨è´å¡å°”æ›²çº¿ç»˜åˆ¶ä¸ŠåŠéƒ¨åˆ†
                    ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, cp3x, cp3y);
                    ctx.bezierCurveTo(endX, endY, endX, -endY, cp3x, -cp3y);
                    ctx.bezierCurveTo(cp2x, -cp2y, cp1x, -cp1y, radius * 0.92, 0);

                    // ä½¿ç”¨æ¸å˜å¡«å……ï¼Œå¢å¼ºå‘å…‰æ•ˆæœ
                    const flareGradient = ctx.createRadialGradient(
                        radius, 0, 0,
                        radius, 0, flareSize
                    );
                    flareGradient.addColorStop(0, "rgba(255, 255, 240, 0.9)");
                    flareGradient.addColorStop(0.3, "rgba(255, 220, 100, 0.7)");
                    flareGradient.addColorStop(0.6, "rgba(255, 180, 30, 0.5)");
                    flareGradient.addColorStop(0.8, "rgba(255, 120, 0, 0.3)");
                    flareGradient.addColorStop(1, "rgba(255, 60, 0, 0)");

                    ctx.fillStyle = flareGradient;
                    ctx.fill();

                    // æ·»åŠ è€€æ–‘ä¸­çš„æ˜äº®çº¹ç†çº¿
                    if (flareIntensity > 0.7) {
                        ctx.beginPath();
                        ctx.moveTo(radius * 0.95, 0);
                        ctx.bezierCurveTo(
                            cp1x * 0.95, cp1y * 0.5,
                            cp2x * 0.95, cp2y * 0.5,
                            endX * 0.9, 0
                        );
                        ctx.strokeStyle = "rgba(255, 255, 220, 0.6)";
                        ctx.lineWidth = radius * 0.02;
                        ctx.stroke();
                    }

                    ctx.restore();
                }

                // 8. è„‰åŠ¨æ•ˆæœ - ä½¿å¤ªé˜³æœ‰å¾®å¦™çš„å‘¼å¸æ•ˆæœ
                const pulseSpeed = 3; // è°ƒæ•´è„‰åŠ¨é€Ÿåº¦
                const pulseAmplitude = 0.04; // å¢å¤§è„‰åŠ¨å¹…åº¦
                const pulsePhase = Math.sin(time * pulseSpeed) * pulseAmplitude;
                const pulseRadius = radius * (1 + pulsePhase);

                ctx.beginPath();
                ctx.arc(x, y, pulseRadius, 0, Math.PI * 2);
                // è„‰åŠ¨å‘å…‰æ•ˆæœ
                const pulseColor = Math.floor(200 + 55 * Math.sin(time * pulseSpeed));
                ctx.fillStyle = `rgba(255, ${pulseColor}, 180, 0.25)`;
                ctx.fill();

                // 9. æ·»åŠ å…‰æ™•è¾¹ç¼˜é—ªçƒæ•ˆæœ
                ctx.save();
                ctx.translate(x, y);

                for (let i = 0; i < 36; i++) {
                    const sparkAngle = (i / 36) * Math.PI * 2;
                    const sparkTime = time * 12 + i * 0.5;
                    const sparkLength = radius * 0.15 * (0.5 + Math.abs(Math.sin(sparkTime)));

                    ctx.save();
                    ctx.rotate(sparkAngle);
                    ctx.beginPath();
                    ctx.moveTo(radius, 0);
                    ctx.lineTo(radius + sparkLength, 0);

                    ctx.strokeStyle = `rgba(255, 255, 200, ${0.4 * Math.sin(sparkTime) * Math.sin(sparkTime)})`;
                    ctx.lineWidth = radius * 0.03;
                    ctx.stroke();
                    ctx.restore();
                }

                ctx.restore();

                // 10. æœ€ç»ˆå…‰æ™•æ•ˆæœ - å¢åŠ æ•´ä½“è¾‰å…‰
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.05, 0, Math.PI * 2);
                const finalGlow = ctx.createRadialGradient(
                    x, y, radius * 0.8,
                    x, y, radius * 1.05
                );
                finalGlow.addColorStop(0, "rgba(255, 255, 200, 0.4)");
                finalGlow.addColorStop(1, "rgba(255, 200, 100, 0)");
                ctx.fillStyle = finalGlow;
                ctx.fill();

                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            // æ°´æ˜Ÿ
            else if (planet.name === "mercury") {
                ctx.save();
                // 1. åŸºç¡€è¡¨é¢ - ä½¿ç”¨æ›´ä¸°å¯Œçš„æ¸å˜
                const mercuryGradient = ctx.createRadialGradient(
                    x - radius * 0.3, y - radius * 0.3, 0,
                    x, y, radius
                );
                mercuryGradient.addColorStop(0, "#E0E0E0"); // æ›´äº®çš„ç°è‰²
                mercuryGradient.addColorStop(0.7, "#B0B0B0"); // ä¸­é—´ç°è‰²
                mercuryGradient.addColorStop(1, "#707070"); // è¾¹ç¼˜æ›´æš—çš„ç°è‰²
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = mercuryGradient;
                ctx.fill();
                // 2. æ°´æ˜Ÿè¡¨é¢çº¹ç† - é¢„å®šä¹‰å›ºå®šä½ç½®çš„é™¨çŸ³å‘
                ctx.save();
                ctx.translate(x, y);
                // ä½¿ç”¨è‡ªè½¬è§’åº¦
                ctx.rotate(planet.rotationAngle);
                // è£å‰ªåˆ°æ°´æ˜Ÿå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // 3. é¢„å®šä¹‰é™¨çŸ³å‘åŒºåŸŸï¼ˆç»™å®ƒä»¬å›ºå®šä½ç½®è€Œä¸æ˜¯éšæœºï¼‰
                const craterPositions = [
                    { x: -0.5, y: -0.4, size: 0.25 },
                    { x: 0.3, y: 0.2, size: 0.18 },
                    { x: 0.1, y: -0.5, size: 0.2 },
                    { x: -0.3, y: 0.6, size: 0.15 },
                    { x: 0.6, y: -0.1, size: 0.23 },
                    { x: -0.6, y: 0.3, size: 0.17 },
                    { x: 0.5, y: 0.5, size: 0.12 },
                    { x: -0.2, y: -0.7, size: 0.14 },
                    { x: -0.7, y: -0.1, size: 0.19 },
                    { x: 0.4, y: -0.6, size: 0.16 }
                ];
                // 4. ä½¿ç”¨3Dé˜´å½±æŠ€æœ¯ç»˜åˆ¶æ›´æ˜æ˜¾çš„é™¨çŸ³å‘
                craterPositions.forEach(crater => {
                    const craterX = radius * crater.x;
                    const craterY = radius * crater.y;
                    const craterSize = radius * crater.size;
                    // ç»˜åˆ¶é™¨çŸ³å‘ï¼Œä½¿ç”¨å¤šå±‚æ¬¡å¢å¼º3Dæ•ˆæœ
                    // å¤–ç¯ - é™¨çŸ³å‘éš†èµ·è¾¹ç¼˜
                    ctx.beginPath();
                    ctx.arc(craterX, craterY, craterSize * 1.1, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(180, 180, 180, 0.7)";
                    ctx.fill();
                    // ä¸­é—´ç¯ - é™¨çŸ³å‘å¹³é¢
                    ctx.beginPath();
                    ctx.arc(craterX, craterY, craterSize, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(100, 100, 100, 0.6)";
                    ctx.fill();
                    // å†…ç¯ - é™¨çŸ³å‘ä¸­å¤®
                    ctx.beginPath();
                    ctx.arc(craterX, craterY, craterSize * 0.7, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(60, 60, 60, 0.7)";
                    ctx.fill();
                    // æ·»åŠ é˜´å½±æ•ˆæœ - å¢å¼º3Dæ„Ÿ
                    // å³ä¸‹æ–¹é«˜å…‰
                    ctx.beginPath();
                    ctx.arc(craterX + craterSize * 0.2, craterY + craterSize * 0.2,
                        craterSize * 0.3, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(210, 210, 210, 0.3)";
                    ctx.fill();
                    // å·¦ä¸Šæ–¹é˜´å½±
                    ctx.beginPath();
                    ctx.arc(craterX - craterSize * 0.2, craterY - craterSize * 0.2,
                        craterSize * 0.3, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(40, 40, 40, 0.4)";
                    ctx.fill();
                });
                // 5. æ·»åŠ ä¸€äº›å¤§å‹æ„é€ ç‰¹å¾ - æ¨¡æ‹Ÿå¡æ´›é‡Œæ–¯ç›†åœ°ç­‰
                ctx.beginPath();
                ctx.ellipse(radius * 0.1, radius * 0.2, radius * 0.6, radius * 0.4, Math.PI / 4, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(120, 120, 120, 0.5)";
                ctx.lineWidth = radius * 0.03;
                ctx.stroke();
                // 6. æ·»åŠ æ˜æ˜¾çš„è¡¨é¢çº¹ç† - æ¨¡æ‹Ÿæ°´æ˜Ÿçš„è¤¶çš±å’Œå´å²–åœ°å½¢
                for (let i = 0; i < 5; i++) {
                    const angle = (i / 5) * Math.PI;
                    const length = radius * 1.8;
                    ctx.beginPath();
                    ctx.moveTo(-Math.cos(angle) * radius, -Math.sin(angle) * radius);
                    ctx.lineTo(Math.cos(angle) * radius, Math.sin(angle) * radius);
                    ctx.strokeStyle = "rgba(130, 130, 130, 0.3)";
                    ctx.lineWidth = radius * 0.01;
                    ctx.stroke();
                }
                ctx.restore(); // æ¢å¤æ—‹è½¬å’Œå¹³ç§»
                // 7. è½»å¾®ç¯å¢ƒå…‰åå°„
                ctx.beginPath();
                ctx.arc(x - radius * 0.5, y - radius * 0.5, radius * 0.3, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
                ctx.fill();
                ctx.restore(); // æ¢å¤æ‰€æœ‰çŠ¶æ€
            }
            // é‡‘æ˜Ÿ
            else if (planet.name === "venus") {
                ctx.save();
                // åŸºç¡€é‡‘é»„è‰²è¡¨é¢
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                // åˆ›å»ºè¡¨é¢æ¸å˜
                const venusGradient = ctx.createRadialGradient(
                    x - radius * 0.2, y - radius * 0.2, 0,
                    x, y, radius
                );
                venusGradient.addColorStop(0, "#FFE6B5");
                venusGradient.addColorStop(1, "#E6C073");
                ctx.fillStyle = venusGradient;
                ctx.fill();
                // æ·»åŠ äº‘å±‚æ•ˆæœ
                ctx.save();
                ctx.translate(x, y);
                // æ—‹è½¬äº‘å±‚ä»¥åˆ›å»ºåŠ¨æ€æ•ˆæœ
                ctx.rotate(planet.rotationAngle);
                // è£å‰ªåˆ°é‡‘æ˜Ÿå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // æ·»åŠ æ¶¡æ—‹äº‘å±‚æ•ˆæœ
                const spiralCount = 3;
                const spiralWidth = radius * 0.3;
                for (let i = 0; i < spiralCount; i++) {
                    const startAngle = (i / spiralCount) * Math.PI * 2;
                    ctx.beginPath();
                    for (let j = 0; j <= 20; j++) {
                        const angle = startAngle + (j / 10) * Math.PI * 2;
                        const spiralRadius = (j / 20) * radius;
                        const x = Math.cos(angle) * spiralRadius;
                        const y = Math.sin(angle) * spiralRadius;
                        if (j === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
                    ctx.lineWidth = spiralWidth;
                    ctx.stroke();
                }
                // æ·»åŠ éšæœºäº‘å—
                const cloudCount = 8;
                ctx.fillStyle = "rgba(255, 255, 255, 0.2)";
                for (let i = 0; i < cloudCount; i++) {
                    const cloudAngle = Math.random() * Math.PI * 2;
                    const cloudDist = Math.random() * radius * 0.8;
                    const cloudSize = Math.random() * radius * 0.3 + radius * 0.1;
                    const cloudX = Math.cos(cloudAngle) * cloudDist;
                    const cloudY = Math.sin(cloudAngle) * cloudDist;
                    ctx.beginPath();
                    ctx.arc(cloudX, cloudY, cloudSize, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore(); // æ¢å¤è£å‰ª
                // æœ€åæ·»åŠ åŸºæœ¬å¤§æ°”æ•ˆæœ
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.05, 0, Math.PI * 2);
                const atmosphere = ctx.createRadialGradient(
                    x, y, radius,
                    x, y, radius * 1.05
                );
                atmosphere.addColorStop(0, "rgba(255, 230, 150, 0.4)");
                atmosphere.addColorStop(1, "rgba(255, 230, 150, 0)");
                ctx.fillStyle = atmosphere;
                ctx.fill();
                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            // åœ°çƒ
            else if (planet.name === "earth") {
                ctx.save(); // ä¿å­˜å½“å‰çŠ¶æ€
                // ç»˜åˆ¶åŸºç¡€æµ·æ´‹
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = "#0077be"; // æµ·æ´‹è“
                ctx.fill();
                // ç»˜åˆ¶å¤§é™†
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(planet.rotationAngle); // åœ°çƒè‡ªè½¬
                // è£å‰ªåˆ°åœ°çƒå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // åŒ—ç¾å¤§é™† (ç®€åŒ–ä¸ºä¸€ä¸ªå½¢çŠ¶)
                ctx.beginPath();
                ctx.moveTo(-radius * 0.3, -radius * 0.3);
                ctx.lineTo(-radius * 0.5, -radius * 0.1);
                ctx.lineTo(-radius * 0.3, radius * 0.2);
                ctx.lineTo(-radius * 0.1, radius * 0.3);
                ctx.lineTo(radius * 0.1, 0);
                ctx.lineTo(0, -radius * 0.3);
                ctx.closePath();
                ctx.fillStyle = "#4caf50"; // ç»¿è‰²å¤§é™†
                ctx.fill();
                // æ¬§äºšå¤§é™†
                ctx.beginPath();
                ctx.moveTo(0, -radius * 0.3);
                ctx.lineTo(radius * 0.4, -radius * 0.1);
                ctx.lineTo(radius * 0.4, radius * 0.2);
                ctx.lineTo(0, radius * 0.4);
                ctx.lineTo(-radius * 0.2, radius * 0.3);
                ctx.closePath();
                ctx.fillStyle = "#4caf50"; // ç»¿è‰²å¤§é™†
                ctx.fill();
                // å—ææ´²
                ctx.beginPath();
                ctx.arc(0, radius * 0.7, radius * 0.3, 0, Math.PI * 2);
                ctx.fillStyle = "#FFFFFF"; // ç™½è‰²æåœ°
                ctx.fill();
                ctx.restore(); // æ¢å¤åˆ°å¹³ç§»å‰
                // äº‘å±‚æ•ˆæœ - åœ¨è¡Œæ˜Ÿä¸Šæ–¹ä»¥åŠé€æ˜ç™½è‰²ç»˜åˆ¶
                ctx.save();
                ctx.translate(x, y);
                // äº‘å±‚éšæ—¶é—´ç§»åŠ¨ï¼Œä¸è·Ÿéšè¡Œæ˜Ÿæ—‹è½¬
                const cloudRotation = Date.now() * 0.0002;
                ctx.rotate(cloudRotation);
                // ç»˜åˆ¶å‡ æœµäº‘
                ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
                for (let i = 0; i < 4; i++) {
                    const cloudAngle = (i / 4) * Math.PI * 2;
                    const cloudX = Math.cos(cloudAngle) * (radius * 0.7);
                    const cloudY = Math.sin(cloudAngle) * (radius * 0.7);
                    const cloudSize = radius * 0.3;
                    ctx.beginPath();
                    ctx.arc(cloudX, cloudY, cloudSize, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore(); // æ¢å¤åˆ°å¹³ç§»å‰
                // å¤§æ°”å±‚æ•ˆæœ
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.05, 0, Math.PI * 2);
                const atmosphere = ctx.createRadialGradient(
                    x, y, radius,
                    x, y, radius * 1.05
                );
                atmosphere.addColorStop(0, "rgba(135, 206, 250, 0.3)");
                atmosphere.addColorStop(1, "rgba(135, 206, 250, 0)");
                ctx.fillStyle = atmosphere;
                ctx.fill();
                ctx.restore(); // æ¢å¤åˆ°åˆå§‹çŠ¶æ€
            }
            // ç«æ˜Ÿ
            else if (planet.name === "mars") {
                ctx.save();
                // åŸºç¡€çº¢è‰²è¡¨é¢
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                // åˆ›å»ºè¡¨é¢æ¸å˜
                const marsGradient = ctx.createRadialGradient(
                    x - radius * 0.2, y - radius * 0.2, 0,
                    x, y, radius
                );
                marsGradient.addColorStop(0, "#ff6b5a"); // äº®çº¢è‰²
                marsGradient.addColorStop(1, "#c1440e"); // æ·±çº¢è‰²
                ctx.fillStyle = marsGradient;
                ctx.fill();
                // æ·»åŠ è¡¨é¢ç‰¹å¾
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(planet.rotationAngle); // ç«æ˜Ÿè‡ªè½¬
                // è£å‰ªåˆ°ç«æ˜Ÿå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // æ·»åŠ ä¸€äº›æš—è‰²åŒºåŸŸæ¨¡æ‹Ÿç«æ˜Ÿé«˜åœ°å’Œè°·åœ°
                const regionsCount = 3;
                for (let i = 0; i < regionsCount; i++) {
                    const regionAngle = (i / regionsCount) * Math.PI * 2;
                    const regionX = Math.cos(regionAngle) * (radius * 0.4);
                    const regionY = Math.sin(regionAngle) * (radius * 0.4);
                    const regionSize = radius * 0.5;
                    ctx.beginPath();
                    ctx.arc(regionX, regionY, regionSize, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(100, 30, 0, 0.2)";
                    ctx.fill();
                }
                // æ·»åŠ å‡ ä¸ªé™¨çŸ³å‘
                const cratersCount = 5;
                for (let i = 0; i < cratersCount; i++) {
                    const craterAngle = Math.random() * Math.PI * 2;
                    const craterDist = Math.random() * radius * 0.7;
                    const craterSize = Math.random() * radius * 0.1 + radius * 0.05;
                    const craterX = Math.cos(craterAngle) * craterDist;
                    const craterY = Math.sin(craterAngle) * craterDist;
                    ctx.beginPath();
                    ctx.arc(craterX, craterY, craterSize, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(80, 20, 0, 0.3)";
                    ctx.fill();
                }
                ctx.restore(); // æ¢å¤è£å‰ª
                // æ·»åŠ æå†°å¸½
                const capSize = radius * 0.25;
                ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                // å—æå†°å¸½
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(planet.rotationAngle); // ä¸è‡ªè½¬ç›¸åŒçš„è§’åº¦
                ctx.beginPath();
                ctx.arc(0, radius * 0.75, capSize, 0, Math.PI * 2);
                ctx.fill();
                // åŒ—æå†°å¸½
                ctx.beginPath();
                ctx.arc(0, -radius * 0.75, capSize * 0.7, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore(); // æ¢å¤å¹³ç§»å’Œæ—‹è½¬
                // è–„å¤§æ°”å±‚æ•ˆæœ
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.03, 0, Math.PI * 2);
                const atmosphere = ctx.createRadialGradient(
                    x, y, radius,
                    x, y, radius * 1.03
                );
                atmosphere.addColorStop(0, "rgba(255, 150, 120, 0.2)");
                atmosphere.addColorStop(1, "rgba(255, 150, 120, 0)");
                ctx.fillStyle = atmosphere;
                ctx.fill();
                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            // æœ¨æ˜Ÿ
            else if (planet.name === "jupiter") {
                ctx.save();
                // åŸºç¡€ç»˜åˆ¶
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = "#e0b44e"; // åŸºç¡€é¢œè‰²
                ctx.fill();
                // æ·»åŠ æ¡çº¹
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(planet.rotationAngle); // è‡ªè½¬
                // è£å‰ªåˆ°æœ¨æ˜ŸèŒƒå›´å†…
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // ç»˜åˆ¶æ¡çº¹
                const stripesCount = 7;
                for (let i = -stripesCount; i <= stripesCount; i++) {
                    const yPos = (i / stripesCount) * radius * 1.5;
                    const stripesHeight = radius * 0.25;
                    ctx.fillStyle = i % 2 === 0 ?
                        "rgba(160, 82, 45, 0.4)" : // æš—è‰²æ¡çº¹
                        "rgba(210, 180, 140, 0.3)"; // äº®è‰²æ¡çº¹
                    ctx.fillRect(-radius, yPos - stripesHeight / 2, radius * 2, stripesHeight);
                }
                // å¤§çº¢æ–‘
                ctx.beginPath();
                ctx.ellipse(radius * 0.4, -radius * 0.2, radius * 0.4, radius * 0.2, 0, 0, Math.PI * 2);
                const spotGradient = ctx.createRadialGradient(
                    radius * 0.4, -radius * 0.2, 0,
                    radius * 0.4, -radius * 0.2, radius * 0.4
                );
                spotGradient.addColorStop(0, "#FF6347"); // ä¸­å¿ƒäº®è‰²
                spotGradient.addColorStop(0.7, "#8B0000"); // è¾¹ç¼˜æš—è‰²
                spotGradient.addColorStop(1, "rgba(139, 0, 0, 0.7)");
                ctx.fillStyle = spotGradient;
                ctx.fill();
                ctx.restore(); // æ¢å¤å‰ªè£
                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            // åœŸæ˜Ÿ
            else if (planet.name === "saturn") {
                ctx.save();
                // ç»˜åˆ¶è¡Œæ˜ŸèƒŒåçš„ç¯éƒ¨åˆ†
                if (planet.rings) {
                    ctx.save();
                    ctx.translate(x, y);
                    // å€¾æ–œç¯ç³»
                    ctx.rotate(Math.PI / 12);
                    ctx.scale(1, 0.35);

                    const ringOuterRadius = planet.ringOuter * zoom;
                    const ringInnerRadius = planet.ringInner * zoom;

                    // ç»˜åˆ¶ç¯çš„ååŠéƒ¨åˆ†ï¼ˆä¸‹åŠéƒ¨åˆ†ï¼‰
                    ctx.beginPath();
                    ctx.arc(0, 0, ringOuterRadius, 0, Math.PI, false); // åªç»˜åˆ¶ä¸‹åŠåœ†
                    ctx.arc(0, 0, ringInnerRadius, Math.PI, 0, true); // é€†æ—¶é’ˆå›åˆ°èµ·ç‚¹
                    ctx.closePath();

                    // åˆ›å»ºç¯çš„æ¸å˜
                    const ringGradient = ctx.createLinearGradient(0, -ringOuterRadius, 0, ringOuterRadius);
                    ringGradient.addColorStop(0, "rgba(230, 220, 210, 0.7)");
                    ringGradient.addColorStop(0.5, "rgba(200, 180, 160, 0.5)");
                    ringGradient.addColorStop(1, "rgba(230, 220, 210, 0.7)");
                    ctx.fillStyle = ringGradient;
                    ctx.fill();

                    // ç»˜åˆ¶å¡è¥¿å°¼ç¼éš™ï¼ˆååŠéƒ¨åˆ†ï¼‰
                    const cassiniRadius = ringOuterRadius * 0.73;
                    ctx.beginPath();
                    ctx.arc(0, 0, cassiniRadius, 0, Math.PI, false);
                    ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
                    ctx.lineWidth = 2 / 0.35;
                    ctx.stroke();

                    ctx.restore(); // æ¢å¤ç¼©æ”¾å’Œæ—‹è½¬
                }

                // åŸºç¡€ç»˜åˆ¶åœŸæ˜Ÿæœ¬ä½“
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                // åˆ›å»ºæ¸å˜
                const saturnGradient = ctx.createRadialGradient(
                    x - radius * 0.2, y - radius * 0.2, 0,
                    x, y, radius
                );
                saturnGradient.addColorStop(0, "#FFF0D1");
                saturnGradient.addColorStop(1, "#e0b44e");
                ctx.fillStyle = saturnGradient;
                ctx.fill();

                // æ·»åŠ æ¡çº¹
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(planet.rotationAngle); // è‡ªè½¬
                // è£å‰ªåˆ°åœŸæ˜Ÿå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // ç»˜åˆ¶è¾ƒç»†çš„æ¡çº¹
                const stripesCount = 5;
                for (let i = -stripesCount; i <= stripesCount; i++) {
                    const yPos = (i / stripesCount) * radius * 1.2;
                    const stripesHeight = radius * 0.15;
                    ctx.fillStyle = i % 2 === 0 ?
                        "rgba(180, 140, 90, 0.3)" : // æš—è‰²æ¡çº¹
                        "rgba(240, 220, 180, 0.2)"; // äº®è‰²æ¡çº¹
                    ctx.fillRect(-radius, yPos - stripesHeight / 2, radius * 2, stripesHeight);
                }
                ctx.restore(); // æ¢å¤è£å‰ª

                // ç»˜åˆ¶ç¯çš„å‰åŠéƒ¨åˆ†ï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰
                if (planet.rings) {
                    ctx.save();
                    ctx.translate(x, y);
                    // å€¾æ–œç¯ç³»
                    ctx.rotate(Math.PI / 12);
                    ctx.scale(1, 0.35);

                    const ringOuterRadius = planet.ringOuter * zoom;
                    const ringInnerRadius = planet.ringInner * zoom;

                    // ç»˜åˆ¶ç¯çš„å‰åŠéƒ¨åˆ†ï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰
                    ctx.beginPath();
                    ctx.arc(0, 0, ringOuterRadius, Math.PI, Math.PI * 2, false); // åªç»˜åˆ¶ä¸ŠåŠåœ†
                    ctx.arc(0, 0, ringInnerRadius, Math.PI * 2, Math.PI, true); // é€†æ—¶é’ˆå›åˆ°èµ·ç‚¹
                    ctx.closePath();

                    // åˆ›å»ºç¯çš„æ¸å˜
                    const ringGradient = ctx.createLinearGradient(0, -ringOuterRadius, 0, ringOuterRadius);
                    ringGradient.addColorStop(0, "rgba(230, 220, 210, 0.7)");
                    ringGradient.addColorStop(0.5, "rgba(200, 180, 160, 0.5)");
                    ringGradient.addColorStop(1, "rgba(230, 220, 210, 0.7)");
                    ctx.fillStyle = ringGradient;
                    ctx.fill();

                    // ç»˜åˆ¶å¡è¥¿å°¼ç¼éš™ï¼ˆå‰åŠéƒ¨åˆ†ï¼‰
                    const cassiniRadius = ringOuterRadius * 0.73;
                    ctx.beginPath();
                    ctx.arc(0, 0, cassiniRadius, Math.PI, Math.PI * 2, false);
                    ctx.strokeStyle = "rgba(0, 0, 0, 0.5)";
                    ctx.lineWidth = 2 / 0.35;
                    ctx.stroke();

                    // å¢åŠ ç¯çš„è¾¹ç¼˜çº¿ä»¥å¢å¼ºæ¸…æ™°åº¦
                    ctx.beginPath();
                    ctx.arc(0, 0, ringOuterRadius, Math.PI, Math.PI * 2, false);
                    ctx.strokeStyle = "rgba(230, 220, 210, 0.8)";
                    ctx.lineWidth = 1 / 0.35;
                    ctx.stroke();

                    ctx.restore(); // æ¢å¤ç¼©æ”¾å’Œæ—‹è½¬
                }

                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            // å¤©ç‹æ˜Ÿ
            else if (planet.name === "uranus") {
                ctx.save();
                // åŸºç¡€ç»˜åˆ¶ - æ›´ä¸°å¯Œçš„è“ç»¿è‰²æ¸å˜
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);

                // åˆ›å»ºæ›´å¤æ‚çš„è¡¨é¢æ¸å˜ï¼Œå¢åŠ è‰²å½©å±‚æ¬¡
                const uranusGradient = ctx.createRadialGradient(
                    x - radius * 0.3, y - radius * 0.3, radius * 0.1,
                    x, y, radius
                );
                uranusGradient.addColorStop(0, "#E1FFFA"); // æ›´äº®çš„é«˜å…‰
                uranusGradient.addColorStop(0.4, "#A2E7E2"); // ä¸­é—´è‰²è°ƒ
                uranusGradient.addColorStop(0.7, "#64B8B0"); // åŸºç¡€è‰²
                uranusGradient.addColorStop(1, "#4A9992"); // è¾¹ç¼˜æ›´æ·±çš„é¢œè‰²

                ctx.fillStyle = uranusGradient;
                ctx.fill();

                // æ·»åŠ åŒ—æå—æå¸½ - å¤©ç‹æ˜Ÿä¸¤æç•¥å¸¦ä¸åŒè‰²è°ƒ
                const poleRadius = radius * 0.3;

                // å—æ
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(Math.PI / 2 + planet.rotationAngle);
                ctx.beginPath();
                ctx.arc(0, radius * 0.7, poleRadius, 0, Math.PI * 2);
                const southPoleGradient = ctx.createRadialGradient(
                    0, radius * 0.7, 0,
                    0, radius * 0.7, poleRadius
                );
                southPoleGradient.addColorStop(0, "rgba(160, 230, 225, 0.4)");
                southPoleGradient.addColorStop(1, "rgba(160, 230, 225, 0)");
                ctx.fillStyle = southPoleGradient;
                ctx.fill();

                // åŒ—æ
                ctx.beginPath();
                ctx.arc(0, -radius * 0.7, poleRadius, 0, Math.PI * 2);
                const northPoleGradient = ctx.createRadialGradient(
                    0, -radius * 0.7, 0,
                    0, -radius * 0.7, poleRadius
                );
                northPoleGradient.addColorStop(0, "rgba(180, 250, 245, 0.5)");
                northPoleGradient.addColorStop(1, "rgba(180, 250, 245, 0)");
                ctx.fillStyle = northPoleGradient;
                ctx.fill();
                ctx.restore();

                // æ·»åŠ æ›´è‡ªç„¶çš„äº‘å¸¦çº¹ç†
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(Math.PI / 2 + planet.rotationAngle);

                // è£å‰ªåˆ°è¡Œæ˜Ÿå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();

                // ç»˜åˆ¶å¤šå±‚æ¬¡äº‘å¸¦ - ä½¿ç”¨ä¸åŒå®½åº¦å’Œé€æ˜åº¦çš„æ¡çº¹
                const bandCount = 12; // å¢åŠ æ¡çº¹æ•°é‡

                // ç»˜åˆ¶ç»†æ¡å¸¦
                for (let i = -bandCount; i <= bandCount; i++) {
                    const yPos = (i / bandCount) * radius;
                    // éšæœºåŒ–æ¡å¸¦é«˜åº¦å’Œé€æ˜åº¦
                    const bandHeight = radius * (0.05 + Math.random() * 0.05);
                    const opacity = 0.05 + Math.random() * 0.1;

                    // æ ¹æ®ä½ç½®å˜åŒ–é¢œè‰² - æ¥è¿‘ä¸¤ææ—¶åè“ï¼Œèµ¤é“å¤„åç»¿
                    const colorMix = Math.abs(i) / bandCount; // 0é è¿‘èµ¤é“ï¼Œ1é è¿‘æç‚¹
                    const greenValue = Math.floor(220 + colorMix * 20);
                    const blueValue = Math.floor(230 + colorMix * 25);

                    ctx.fillStyle = `rgba(180, ${greenValue}, ${blueValue}, ${opacity})`;
                    ctx.fillRect(-radius * 1.2, yPos - bandHeight / 2, radius * 2.4, bandHeight);
                }

                // æ·»åŠ ä¸€äº›æ›´æ¸…æ™°å¯è§çš„ç‰¹å¾äº‘å›¢
                for (let i = 0; i < 6; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * radius * 0.7;
                    const size = radius * (0.1 + Math.random() * 0.15);
                    const x = Math.cos(angle) * distance;
                    const y = Math.sin(angle) * distance;

                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(200, 255, 250, ${0.1 + Math.random() * 0.15})`;
                    ctx.fill();
                }

                ctx.restore(); // æ¢å¤è£å‰ª

                // ç»˜åˆ¶æ›´ç²¾ç»†çš„ç¯ç³»
                if (planet.rings) {
                    ctx.save();
                    ctx.translate(x, y);

                    // å¤©ç‹æ˜Ÿçš„ç¯ç³»å‡ ä¹å‚ç›´äºè½¨é“å¹³é¢
                    ctx.rotate(Math.PI / 2);
                    ctx.scale(1, 0.05); // æ‰å¹³çš„ç¯

                    const ringOuterRadius = planet.ringOuter * zoom;
                    const ringInnerRadius = planet.ringInner * zoom;

                    // ç»˜åˆ¶å¤šå±‚ç¯å¸¦ï¼Œå¢åŠ ç»†èŠ‚
                    const ringLayers = 5;
                    const ringWidth = (ringOuterRadius - ringInnerRadius) / ringLayers;

                    for (let i = 0; i < ringLayers; i++) {
                        const innerR = ringInnerRadius + i * ringWidth;
                        const outerR = innerR + ringWidth;

                        ctx.beginPath();
                        ctx.arc(0, 0, outerR, 0, Math.PI * 2);
                        ctx.arc(0, 0, innerR, 0, Math.PI * 2, true);

                        // äº¤æ›¿ä¸åŒäº®åº¦çš„ç¯å¸¦
                        const opacity = i % 2 === 0 ? 0.35 : 0.2;
                        ctx.fillStyle = `rgba(220, 240, 240, ${opacity})`;
                        ctx.fill();
                    }

                    // æ·»åŠ ç»†å°çš„è£‚ç¼å’Œé—´éš™ - å¤©ç‹æ˜Ÿç¯æœ‰å‡ ä¸ªçª„é—´éš™
                    const gapPositions = [ringInnerRadius + ringWidth * 1.5, ringInnerRadius + ringWidth * 3.2];
                    const gapWidth = ringWidth * 0.2;

                    for (const gapPos of gapPositions) {
                        ctx.beginPath();
                        ctx.arc(0, 0, gapPos + gapWidth / 2, 0, Math.PI * 2);
                        ctx.arc(0, 0, gapPos - gapWidth / 2, 0, Math.PI * 2, true);
                        ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
                        ctx.fill();
                    }

                    // ç¯ç³»è½®å»“æ•ˆæœ
                    ctx.beginPath();
                    ctx.arc(0, 0, ringOuterRadius, 0, Math.PI * 2);
                    ctx.strokeStyle = "rgba(240, 255, 255, 0.6)";
                    ctx.lineWidth = 1.5 / 0.05;
                    ctx.stroke();

                    ctx.restore(); // æ¢å¤ç¼©æ”¾å’Œæ—‹è½¬
                }

                // å¢å¼ºå¤§æ°”å±‚æ•ˆæœ - ä½¿ç”¨å¤šå±‚å¤§æ°”
                // å†…å±‚å¤§æ°” - æ›´æ˜æ˜¾çš„è“è‰²é›¾çŠ¶
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.02, 0, Math.PI * 2);
                const innerAtmosphere = ctx.createRadialGradient(
                    x, y, radius,
                    x, y, radius * 1.02
                );
                innerAtmosphere.addColorStop(0, "rgba(160, 235, 230, 0.25)");
                innerAtmosphere.addColorStop(1, "rgba(160, 235, 230, 0)");
                ctx.fillStyle = innerAtmosphere;
                ctx.fill();

                // å¤–å±‚å¤§æ°” - æ›´æ‰©æ•£çš„æ•ˆæœ
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.05, 0, Math.PI * 2);
                const outerAtmosphere = ctx.createRadialGradient(
                    x, y, radius * 1.02,
                    x, y, radius * 1.05
                );
                outerAtmosphere.addColorStop(0, "rgba(200, 255, 250, 0.15)");
                outerAtmosphere.addColorStop(1, "rgba(200, 255, 250, 0)");
                ctx.fillStyle = outerAtmosphere;
                ctx.fill();

                // æ·»åŠ è½»å¾®çš„åœ°é¢åå…‰æ•ˆæœ
                ctx.beginPath();
                ctx.arc(x - radius * 0.15, y - radius * 0.15, radius * 0.6, 0, Math.PI * 2);
                const highlight = ctx.createRadialGradient(
                    x - radius * 0.15, y - radius * 0.15, 0,
                    x - radius * 0.15, y - radius * 0.15, radius * 0.6
                );
                highlight.addColorStop(0, "rgba(255, 255, 255, 0.1)");
                highlight.addColorStop(1, "rgba(255, 255, 255, 0)");
                ctx.fillStyle = highlight;
                ctx.fill();

                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            // æµ·ç‹æ˜Ÿ
            else if (planet.name === "neptune") {
                ctx.save();
                // åŸºç¡€æ·±è“è‰²
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                // åˆ›å»ºè¡¨é¢æ¸å˜
                const neptuneGradient = ctx.createRadialGradient(
                    x - radius * 0.2, y - radius * 0.2, 0,
                    x, y, radius
                );
                neptuneGradient.addColorStop(0, "#6B93D6");
                neptuneGradient.addColorStop(1, "#3A4CA8");
                ctx.fillStyle = neptuneGradient;
                ctx.fill();
                // æ·»åŠ äº‘çº¹å’Œç‰¹å¾
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(planet.rotationAngle); // è‡ªè½¬
                // è£å‰ªåˆ°è¡Œæ˜Ÿå†…éƒ¨
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.clip();
                // ç»˜åˆ¶å‡ ä¸ªæ·¡æ¡çº¹
                const stripesCount = 4;
                for (let i = -stripesCount; i <= stripesCount; i++) {
                    const yPos = (i / stripesCount) * radius * 1.2;
                    const stripesHeight = radius * 0.15;
                    ctx.fillStyle = "rgba(150, 180, 255, 0.2)";
                    ctx.fillRect(-radius, yPos - stripesHeight / 2, radius * 2, stripesHeight);
                }
                // æ·»åŠ å¤§æš—æ–‘ç‰¹å¾
                ctx.beginPath();
                ctx.ellipse(radius * 0.3, -radius * 0.3, radius * 0.3, radius * 0.2, 0, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(30, 60, 130, 0.5)";
                ctx.fill();
                // æ·»åŠ å‡ ä¸ªå°æš—æ–‘
                const spotsCount = 3;
                for (let i = 0; i < spotsCount; i++) {
                    const spotAngle = (i / spotsCount) * Math.PI * 2;
                    const spotDist = radius * 0.5;
                    const spotX = Math.cos(spotAngle) * spotDist;
                    const spotY = Math.sin(spotAngle) * spotDist;
                    const spotSizeX = radius * 0.15;
                    const spotSizeY = radius * 0.1;
                    ctx.beginPath();
                    ctx.ellipse(spotX, spotY, spotSizeX, spotSizeY, 0, 0, Math.PI * 2);
                    ctx.fillStyle = "rgba(30, 60, 130, 0.4)";
                    ctx.fill();
                }
                ctx.restore(); // æ¢å¤è£å‰ª
                // å¤§æ°”å±‚æ•ˆæœ
                ctx.beginPath();
                ctx.arc(x, y, radius * 1.03, 0, Math.PI * 2);
                const atmosphere = ctx.createRadialGradient(
                    x, y, radius,
                    x, y, radius * 1.03
                );
                atmosphere.addColorStop(0, "rgba(150, 180, 255, 0.2)");
                atmosphere.addColorStop(1, "rgba(150, 180, 255, 0)");
                ctx.fillStyle = atmosphere;
                ctx.fill();
                ctx.restore(); // æ¢å¤åˆå§‹çŠ¶æ€
            }
            else {
                // åŸºæœ¬è¡Œæ˜Ÿç»˜åˆ¶
                ctx.beginPath();
                ctx.arc(x, y, Math.max(1, radius), 0, Math.PI * 2);
                ctx.fillStyle = `#${planet.color}`;
                ctx.fill();

                // å‘å…‰æ•ˆæœ
                if (glowEffectEnabled) {
                    ctx.save();
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 1.5, 0, Math.PI * 2);
                    const glowGradient = ctx.createRadialGradient(x, y, radius, x, y, radius * 1.5);
                    glowGradient.addColorStop(0, `#${planet.color}`);
                    glowGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    ctx.fillStyle = glowGradient;
                    ctx.fill();
                    ctx.restore();
                }

                // ç»˜åˆ¶ç¯
                if (planet.rings) {
                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(Math.PI / 12);
                    ctx.scale(1, 0.35);
                    
                    const ringOuterRadius = planet.ringOuter * zoom;
                    const ringInnerRadius = planet.ringInner * zoom;
                    
                    ctx.beginPath();
                    ctx.arc(0, 0, ringOuterRadius, 0, Math.PI * 2);
                    ctx.arc(0, 0, ringInnerRadius, 0, Math.PI * 2, true);
                    ctx.fillStyle = planet.ringColor ? `#${planet.ringColor}80` : "rgba(200, 200, 200, 0.5)";
                    ctx.fill();
                    
                    ctx.restore();
                }
            }

            // ç»˜åˆ¶å«æ˜Ÿ
            if (planet.moons && Array.isArray(planet.moons)) {
                planet.moons.forEach(moon => {
                    const moonOrbitRadius = moon.distance * zoom;
                    const moonX = x + moonOrbitRadius * Math.cos(moon.angle);
                    const moonY = y + moonOrbitRadius * Math.sin(moon.angle);
                    const moonRadius = Math.max(1, moon.radius * zoom);

                    // å«æ˜Ÿè½¨é“
                    ctx.save();
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    ctx.arc(x, y, moonOrbitRadius, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    ctx.restore();

                    // å«æ˜Ÿæœ¬ä½“
                    ctx.beginPath();
                    ctx.arc(moonX, moonY, moonRadius, 0, Math.PI * 2);
                    ctx.fillStyle = "#CCCCCC";
                    ctx.fill();
                });
            }

            // æ›´æ–°æ ‡ç­¾ä½ç½®
            const labelElem = document.getElementById(`${planet.name}-label`);
            if (labelElem) {
                const labelTop = y - radius - labelElem.offsetHeight - 5;
                labelElem.style.left = `${x}px`;
                labelElem.style.top = `${labelTop}px`;
                labelElem.style.opacity = showLabels ? "1" : "0";
                labelElem.style.pointerEvents = 'none';
            }

            return { x, y, radius: radius, name: planet.name };
        }

        // åˆ›å»ºæˆ–æ›´æ–°è¡Œæ˜Ÿæ ‡ç­¾ - ä½¿ç”¨GSAPåŠ¨ç”»
        function createLabels() {
            planetLabels.forEach(label => {
                gsap.to(label, { 
                    duration: 0.3, 
                    opacity: 0, 
                    onComplete: () => label.remove() 
                });
            });
            planetLabels = [];

            planets.forEach(planet => {
                const label = document.createElement('div');
                label.id = `${planet.name}-label`;
                label.className = 'planet-label';
                
                const nameMap = {
                    sun: "â˜€ï¸ å¤ªé˜³", mercury: "â˜¿ æ°´æ˜Ÿ", venus: "â™€ é‡‘æ˜Ÿ", earth: "ğŸŒ åœ°çƒ",
                    mars: "â™‚ ç«æ˜Ÿ", jupiter: "â™ƒ æœ¨æ˜Ÿ", saturn: "â™„ åœŸæ˜Ÿ",
                    uranus: "â›¢ å¤©ç‹æ˜Ÿ", neptune: "â™† æµ·ç‹æ˜Ÿ"
                };
                label.textContent = nameMap[planet.name] || planet.name;
                label.style.opacity = showLabels ? "1" : "0";
                label.style.pointerEvents = 'none';
                
                simulationContainer.appendChild(label);
                planetLabels.push(label);

                // GSAPå…¥åœºåŠ¨ç”»
                gsap.fromTo(label, 
                    { opacity: 0, scale: 0.8 }, 
                    { duration: 0.5, opacity: showLabels ? 1 : 0, scale: 1, ease: "back.out(1.7)" }
                );
            });
        }

        // åˆ›å»ºè¡Œæ˜Ÿå¼¹å‡ºçª—å£
        function createPlanetPopup() {
            const popup = document.createElement('div');
            popup.id = 'planet-popup';
            popup.className = 'planet-popup';
            popup.style.display = 'none';
            simulationContainer.appendChild(popup);
            return popup;
        }

        // æ˜¾ç¤ºè¡Œæ˜Ÿå¼¹å‡ºä¿¡æ¯
        function showPlanetPopup(planetData, clientX, clientY) {
            const popup = document.getElementById('planet-popup');
            if (!popup) return;

            const planet = planets.find(p => p.name === planetData.name);
            if (!planet) return;

            const nameMap = {
                sun: "â˜€ï¸ å¤ªé˜³", mercury: "â˜¿ æ°´æ˜Ÿ", venus: "â™€ é‡‘æ˜Ÿ", earth: "ğŸŒ åœ°çƒ",
                mars: "â™‚ ç«æ˜Ÿ", jupiter: "â™ƒ æœ¨æ˜Ÿ", saturn: "â™„ åœŸæ˜Ÿ",
                uranus: "â›¢ å¤©ç‹æ˜Ÿ", neptune: "â™† æµ·ç‹æ˜Ÿ"
            };

            let orbitPeriod = planet.orbit;
            let orbitUnit = 'å¤©';
            if (orbitPeriod > 365) {
                orbitPeriod = (orbitPeriod / 365).toFixed(1);
                orbitUnit = 'å¹´';
            }

            popup.innerHTML = `
                <h3>${nameMap[planet.name] || planet.name}</h3>
                <p>ğŸ” åŠå¾„: ${planet.radius} åƒç´ </p>
                <p>ğŸ“ è·å¤ªé˜³: ${planet.distance} åƒç´ </p>
                ${planet.orbit ? `<p>ğŸ”„ å…¬è½¬å‘¨æœŸ: ${orbitPeriod} ${orbitUnit}</p>` : ''}
                ${planet.moons.length ? `<p>ğŸŒ™ å«æ˜Ÿæ•°: ${planet.moons.length}</p>` : ''}
                ${planet.rings ? `<p>ğŸ’ æœ‰å…‰ç¯</p>` : ''}
            `;

            popup.style.left = `${clientX}px`;
            popup.style.top = `${clientY}px`;
            
            // GSAPæ˜¾ç¤ºåŠ¨ç”»
            gsap.fromTo(popup, 
                { opacity: 0, scale: 0.8, display: 'block' },
                { duration: 0.3, opacity: 1, scale: 1, ease: "back.out(1.7)" }
            );

            // è‡ªåŠ¨éšè—
            if (window.popupTimeout) clearTimeout(window.popupTimeout);
            window.popupTimeout = setTimeout(() => {
                gsap.to(popup, { 
                    duration: 0.3, 
                    opacity: 0, 
                    scale: 0.8, 
                    onComplete: () => popup.style.display = 'none' 
                });
            }, 3000);

            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
            audioManager.playClickSound();
        }

        // åˆ›å»ºé€šçŸ¥ - ä½¿ç”¨GSAP
        function createNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'planet-label';
            notification.style.position = 'fixed';
            notification.style.bottom = '180px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.padding = '10px 20px';
            notification.style.fontSize = '16px';
            notification.style.backgroundColor = 'rgba(0, 0, 0, 0.9)';
            notification.style.zIndex = '1000';
            notification.style.borderRadius = '25px';
            notification.textContent = message;
            
            document.body.appendChild(notification);

            // GSAPåŠ¨ç”»
            gsap.fromTo(notification, 
                { opacity: 0, y: 20, scale: 0.8 },
                { duration: 0.5, opacity: 1, y: 0, scale: 1, ease: "back.out(1.7)" }
            );

            setTimeout(() => {
                gsap.to(notification, {
                    duration: 0.5,
                    opacity: 0,
                    y: -20,
                    scale: 0.8,
                    ease: "back.in(1.7)",
                    onComplete: () => document.body.removeChild(notification)
                });
            }, 2500);
        }

        // è·å–ä¸­æ–‡åç§°
        function getChineseName(planetName) {
            const nameMap = {
                sun: "å¤ªé˜³", mercury: "æ°´æ˜Ÿ", venus: "é‡‘æ˜Ÿ", earth: "åœ°çƒ",
                mars: "ç«æ˜Ÿ", jupiter: "æœ¨æ˜Ÿ", saturn: "åœŸæ˜Ÿ",
                uranus: "å¤©ç‹æ˜Ÿ", neptune: "æµ·ç‹æ˜Ÿ"
            };
            return nameMap[planetName] || planetName;
        }

        // åˆ‡æ¢å°è¡Œæ˜Ÿå¸¦
        function toggleAsteroidBelt() {
            showAsteroidBelt = !showAsteroidBelt;
            
            if (showAsteroidBelt) {
                if (asteroids.length === 0) {
                    generateAsteroidBelt();
                }
                document.getElementById('toggle-asteroid-belt-btn').textContent = 'ğŸ™ˆ éšè—å°è¡Œæ˜Ÿå¸¦';
                
                // GSAPæ˜¾ç¤ºåŠ¨ç”»
                gsap.to(asteroidInfoDiv, { duration: 0.3, opacity: 1, display: 'block' });
                showPlanetInfo('asteroid-belt');
                
                createNotification('ğŸª¨ å°è¡Œæ˜Ÿå¸¦å·²å¯ç”¨');
            } else {
                document.getElementById('toggle-asteroid-belt-btn').textContent = 'ğŸª¨ æ˜¾ç¤ºå°è¡Œæ˜Ÿå¸¦';
                
                gsap.to(asteroidInfoDiv, { duration: 0.3, opacity: 0, onComplete: () => {
                    asteroidInfoDiv.style.display = 'none';
                }});
                showIntroContent();
                
                createNotification('ğŸš« å°è¡Œæ˜Ÿå¸¦å·²å…³é—­');
            }
            
            audioManager.playClickSound();
        }

        // æ˜¾ç¤ºä»‹ç»å†…å®¹ - ä½¿ç”¨GSAP
        function showIntroContent() {
            gsap.to(allPlanetInfoDivs, { duration: 0.3, opacity: 0, onComplete: () => {
                allPlanetInfoDivs.forEach(elem => elem.style.display = 'none');
            }});
            
            setTimeout(() => {
                introContent.style.display = 'block';
                gsap.fromTo(introContent, 
                    { opacity: 0, y: 20 },
                    { duration: 0.5, opacity: 1, y: 0 }
                );
            }, 300);

            if (!infoPanelVisible) {
                toggleInfoPanel();
            }
            infoPanel.scrollTop = 0;
        }

        // å…³é—­æ•´ä¸ªä¿¡æ¯é¢æ¿ - ä½¿ç”¨GSAP
        function closeInfoPanel() {
            gsap.to(infoPanel, {
                duration: 0.4,
                opacity: 0,
                x: 20,
                scale: 0.95,
                ease: "back.in(1.7)",
                onComplete: () => {
                    infoPanel.classList.add('hidden');
                    infoPanelVisible = false;
                    infoToggleBtn.textContent = 'ğŸ“‹ æ˜¾ç¤ºä¿¡æ¯';
                }
            });
            audioManager.playClickSound();
        }

        window.closeInfoPanel = closeInfoPanel;

        // åˆ‡æ¢ä¿¡æ¯é¢æ¿å¯è§æ€§ - ä½¿ç”¨GSAP
        function toggleInfoPanel() {
            infoPanelVisible = !infoPanelVisible;
            
            if (infoPanelVisible) {
                infoPanel.classList.remove('hidden');
                gsap.fromTo(infoPanel,
                    { opacity: 0, x: 20, scale: 0.95 },
                    { duration: 0.4, opacity: 1, x: 0, scale: 1, ease: "back.out(1.7)" }
                );
                infoToggleBtn.textContent = 'ğŸ“‹ éšè—ä¿¡æ¯';
                
                const anyPlanetInfoVisible = Array.from(allPlanetInfoDivs).some(div => div.style.display === 'block');
                if (!anyPlanetInfoVisible) {
                    showIntroContent();
                }
            } else {
                closeInfoPanel();
            }
            
            audioManager.playClickSound();
        }

        // æ›´æ–°ç¼©æ”¾å€¼æ˜¾ç¤º
        function updateZoomValueDisplay() {
            zoomValueDisplay.textContent = `ğŸ” ç¼©æ”¾: ${zoom.toFixed(1)}x`;
            
            // ç¼©æ”¾å€¼å˜åŒ–åŠ¨ç”»
            gsap.fromTo(zoomValueDisplay, 
                { scale: 1.2 }, 
                { duration: 0.2, scale: 1, ease: "back.out(1.7)" }
            );
        }

        // å¤„ç†ç¼©æ”¾ - ä½¿ç”¨GSAPä¼˜åŒ–
        function handleZoom(delta, clientX, clientY) {
            const targetZoom = Math.max(zoomMin, Math.min(zoomMax, zoom + delta * zoomStep));
            const mouseX = clientX - baseX - offsetX;
            const mouseY = clientY - baseY - offsetY;
            
            animateZoom(targetZoom, mouseX, mouseY);
        }

        // å¹³æ»‘ç¼©æ”¾åŠ¨ç”»å‡½æ•° - ä½¿ç”¨GSAP
        function animateZoom(targetZoom, mouseX, mouseY) {
            const startZoom = zoom;
            const startOffsetX = offsetX;
            const startOffsetY = offsetY;

            gsap.to({ progress: 0 }, {
                progress: 1,
                duration: 0.3,
                ease: "power2.out",
                onUpdate: function() {
                    const progress = this.targets()[0].progress;
                    zoom = startZoom + (targetZoom - startZoom) * progress;
                    
                    if (targetZoom !== startZoom) {
                        const scaleFactor = zoom / startZoom;
                        offsetX = startOffsetX + mouseX * (1 - scaleFactor);
                        offsetY = startOffsetY + mouseY * (1 - scaleFactor);
                    }
                    
                    updateZoomValueDisplay();
                    centerX = baseX + offsetX;
                    centerY = baseY + offsetY;
                },
                onComplete: () => {
                    planets.forEach(planet => {
                        if (planet.name !== "sun") {
                            planet.trail = [];
                        }
                    });
                }
            });
        }

        // è®¾ç½®äº¤äº’æ§åˆ¶
        function setupInteractionControls() {
            let accumulatedDelta = 0;
            let zoomTimeout = null;

            // é¼ æ ‡æ»šè½®ç¼©æ”¾
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                accumulatedDelta -= e.deltaY * 0.005;
                
                if (zoomTimeout) clearTimeout(zoomTimeout);
                zoomTimeout = setTimeout(() => {
                    handleZoom(accumulatedDelta, e.clientX, e.clientY);
                    accumulatedDelta = 0;
                    zoomTimeout = null;
                }, 10);
            });

            // é¼ æ ‡æ‹–åŠ¨
            canvas.addEventListener('mousedown', (e) => {
                if (e.button === 0) {
                    handleDragStart(e);
                }
            });

            function handleDragStart(e) {
                e.preventDefault();
                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                lastOffsetX = offsetX;
                lastOffsetY = offsetY;
                
                gsap.to(canvas, { duration: 0.2, scale: 0.98 });
                canvas.classList.add('grabbing');
            }

            window.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const dx = e.clientX - dragStartX;
                    const dy = e.clientY - dragStartY;
                    
                    offsetX = lastOffsetX + dx;
                    offsetY = lastOffsetY + dy;
                    centerX = baseX + offsetX;
                    centerY = baseY + offsetY;
                    
                    planets.forEach(planet => {
                        if (planet.name !== "sun") {
                            planet.trail = [];
                        }
                    });
                }
            });

            window.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    gsap.to(canvas, { duration: 0.2, scale: 1 });
                    canvas.classList.remove('grabbing');
                }
            });

            // Hammer.js è§¦æ‘¸æ‰‹åŠ¿
            hammertime.on('panstart', (e) => {
                isDragging = true;
                dragStartX = e.center.x;
                dragStartY = e.center.y;
                lastOffsetX = offsetX;
                lastOffsetY = offsetY;
            });

            hammertime.on('panmove', (e) => {
                if (isDragging) {
                    const dx = e.center.x - dragStartX;
                    const dy = e.center.y - dragStartY;
                    
                    offsetX = lastOffsetX + dx;
                    offsetY = lastOffsetY + dy;
                    centerX = baseX + offsetX;
                    centerY = baseY + offsetY;
                }
            });

            hammertime.on('panend', () => {
                isDragging = false;
            });

            // è§¦æ‘¸ç¼©æ”¾
            hammertime.on('pinchstart', (e) => {
                touchZoomStartScale = zoom;
            });

            hammertime.on('pinchmove', (e) => {
                const newZoom = Math.max(zoomMin, Math.min(zoomMax, touchZoomStartScale * e.scale));
                zoom = newZoom;
                updateZoomValueDisplay();
                centerX = baseX + offsetX;
                centerY = baseY + offsetY;
            });
        }

        // æ›´æ–°è¡Œæ˜Ÿä¿¡æ¯
        function updatePlanetInfo() {
            planets.forEach(planet => {
                const infoDiv = document.getElementById(`${planet.name}-info`);
                if (infoDiv && infoDiv.style.display === 'block') {
                    let dynamicInfo = document.getElementById(`${planet.name}-dynamic-info`);
                    if (!dynamicInfo) {
                        dynamicInfo = document.createElement('div');
                        dynamicInfo.id = `${planet.name}-dynamic-info`;
                        dynamicInfo.className = 'dynamic-planet-info';
                        dynamicInfo.style.marginTop = '15px';
                        dynamicInfo.style.padding = '15px';
                        dynamicInfo.style.background = 'linear-gradient(135deg, rgba(100, 181, 246, 0.1), rgba(25, 118, 210, 0.1))';
                        dynamicInfo.style.borderRadius = '10px';
                        dynamicInfo.style.border = '1px solid rgba(100, 181, 246, 0.3)';
                        infoDiv.appendChild(dynamicInfo);
                    }

                    const orbitProgress = ((planet.angle / (Math.PI * 2)) * 100).toFixed(1);
                    const orbitPeriodDays = planet.orbit;
                    const daysPerSecond = orbitPeriodDays * speed / 60;

                    dynamicInfo.innerHTML = `
                        <h3>ğŸ“Š å®æ—¶æ•°æ®</h3>
                        <p>ğŸ”„ å…¬è½¬è¿›åº¦: ${orbitProgress}%</p>
                        <p>âš¡ æ¨¡æ‹Ÿé€Ÿåº¦: ${daysPerSecond.toFixed(2)} å¤©/ç§’</p>
                        <p>ğŸ“ å½“å‰è§’åº¦: ${(planet.angle * 180 / Math.PI).toFixed(1)}Â°</p>
                        ${planet.rotationSpeed ? `<p>ğŸŒ€ è‡ªè½¬é€Ÿåº¦: ${(planet.rotationSpeed * speed).toFixed(4)} rad/å¸§</p>` : ''}
                        <p>ğŸ” å½“å‰ç¼©æ”¾: ${zoom.toFixed(2)}x</p>
                    `;
                }
            });
        }

        // æ˜¾ç¤ºè¡Œæ˜Ÿä¿¡æ¯é¢æ¿ - ä½¿ç”¨GSAP
        function showPlanetInfo(planetName) {
            gsap.to(introContent, { duration: 0.3, opacity: 0, onComplete: () => {
                introContent.style.display = 'none';
            }});
            
            gsap.to(allPlanetInfoDivs, { duration: 0.3, opacity: 0, onComplete: () => {
                allPlanetInfoDivs.forEach(elem => elem.style.display = 'none');
            }});

            setTimeout(() => {
                const planetInfoDiv = document.getElementById(`${planetName}-info`);
                if (planetInfoDiv) {
                    planetInfoDiv.style.display = 'block';
                    gsap.fromTo(planetInfoDiv,
                        { opacity: 0, y: 20 },
                        { duration: 0.5, opacity: 1, y: 0 }
                    );
                    
                    if (!infoPanelVisible) {
                        toggleInfoPanel();
                    }
                    infoPanel.scrollTop = 0;
                }
            }, 300);
        }

        // ä¸»ç»˜åˆ¶å¾ªç¯
        let lastTimestamp = 0;
        function draw(timestamp) {
            stats.begin(); // æ€§èƒ½ç›‘æ§å¼€å§‹
            
            const timeDelta = timestamp - lastTimestamp;
            const timeScale = Math.min(timeDelta / (1000 / 60), 5);
            lastTimestamp = timestamp;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            baseX = canvas.width / 2;
            baseY = canvas.height / 2;
            centerX = baseX + offsetX;
            centerY = baseY + offsetY;

            // ç»˜åˆ¶èƒŒæ™¯
            drawStarfield();
            
            // æ›´æ–°å’Œç»˜åˆ¶ç²’å­ç³»ç»Ÿ
            if (particleSystem) {
                particleSystem.update();
                particleSystem.draw();
            }

            updatePositions(timeScale);
            drawAsteroidBelt();
            planetScreenData = planets.map(planet => drawCelestialBody(planet));

            if (!paused) {
                updatePlanetInfo();
            }

            stats.end(); // æ€§èƒ½ç›‘æ§ç»“æŸ
            requestAnimationFrame(draw);
        }

        // åˆ‡æ¢è½¨è¿¹æ˜¾ç¤º/éšè—
        function toggleTrails() {
            const allTrailsOn = planets.every(p => p.name === "sun" || p.showTrail);
            planets.forEach(planet => {
                if (planet.name !== "sun") {
                    planet.showTrail = !allTrailsOn;
                    if (!planet.showTrail) {
                        planet.trail = [];
                    }
                }
            });
            
            toggleTrailsBtn.textContent = allTrailsOn ? 'ğŸŒŸ æ˜¾ç¤ºè½¨è¿¹' : 'ğŸ™ˆ éšè—è½¨è¿¹';
            
            // åˆ›å»ºé€šçŸ¥
            createNotification(allTrailsOn ? 'ğŸš« è½¨è¿¹å·²å…³é—­' : 'ğŸŒŸ è½¨è¿¹å·²å¯ç”¨');
            audioManager.playClickSound();
        }

        // åˆ‡æ¢å‘å…‰æ•ˆæœ
        function toggleGlowEffect() {
            glowEffectEnabled = !glowEffectEnabled;
            
            const btn = document.getElementById('toggle-glow-btn');
            btn.textContent = glowEffectEnabled ? 'ğŸ™ˆ å…³é—­å‘å…‰' : 'âœ¨ å‘å…‰æ•ˆæœ';
            
            // æ›´æ–°ç”»å¸ƒæ»¤é•œ
            gsap.to(canvas, {
                duration: 0.5,
                filter: glowEffectEnabled ? 'drop-shadow(0 0 20px rgba(255, 255, 255, 0.3))' : 'none'
            });
            
            createNotification(glowEffectEnabled ? 'âœ¨ å‘å…‰æ•ˆæœå·²å¯ç”¨' : 'ğŸš« å‘å…‰æ•ˆæœå·²å…³é—­');
            audioManager.playClickSound();
        }

        // è®¾ç½®é”®ç›˜æ§åˆ¶
        function setupKeyboardControls() {
            window.addEventListener('keydown', (e) => {
                // é˜²æ­¢åœ¨è¾“å…¥æ¡†ä¸­è§¦å‘
                if (e.target.tagName === 'INPUT') return;
                
                switch (e.key.toLowerCase()) {
                    case ' ':
                        e.preventDefault();
                        togglePause();
                        break;
                    case 'r':
                        resetSimulation();
                        break;
                    case 'l':
                        toggleLabels();
                        break;
                    case 't':
                        toggleTrails();
                        break;
                    case 'i':
                        toggleInfoPanel();
                        break;
                    case 'a':
                        toggleAsteroidBelt();
                        break;
                    case 'g':
                        toggleGlowEffect();
                        break;
                    case 'f':
                        toggleFullscreen();
                        break;
                    case '+':
                    case '=':
                        changeSpeed(0.01);
                        break;
                    case '-':
                        changeSpeed(-0.01);
                        break;
                    case 'arrowup':
                        e.preventDefault();
                        handleZoom(1, canvas.width / 2, canvas.height / 2);
                        break;
                    case 'arrowdown':
                        e.preventDefault();
                        handleZoom(-1, canvas.width / 2, canvas.height / 2);
                        break;
                }
            });
        }

        // ä¿®æ”¹é€Ÿåº¦çš„è¾…åŠ©å‡½æ•°
        function changeSpeed(delta) {
            const speedSlider = document.getElementById('speed-slider');
            let newSpeed = parseFloat(speedSlider.value) + delta;
            newSpeed = Math.max(parseFloat(speedSlider.min), Math.min(parseFloat(speedSlider.max), newSpeed));
            speedSlider.value = newSpeed;
            speedSlider.dispatchEvent(new Event('input'));
        }

        // å…¨å±åŠŸèƒ½
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    createNotification('ğŸ–¥ï¸ å·²è¿›å…¥å…¨å±æ¨¡å¼');
                }).catch(err => {
                    createNotification('âŒ æ— æ³•è¿›å…¥å…¨å±æ¨¡å¼');
                });
            } else {
                document.exitFullscreen().then(() => {
                    createNotification('ğŸªŸ å·²é€€å‡ºå…¨å±æ¨¡å¼');
                });
            }
            audioManager.playClickSound();
        }

        // æˆªå›¾åŠŸèƒ½
        function takeScreenshot() {
            const link = document.createElement('a');
            link.download = `å¤ªé˜³ç³»æ¨¡æ‹Ÿ_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            createNotification('ğŸ“· æˆªå›¾å·²ä¿å­˜');
            audioManager.playClickSound();
        }

        // å¤„ç†ç”»å¸ƒç‚¹å‡»äº‹ä»¶
        function handleCanvasClick(event) {
            if (isDragging) return;
            
            if (event.button === 2) {
                event.preventDefault();
            }

            const rect = canvas.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const clickY = event.clientY - rect.top;
            let clickedPlanetName = null;

            for (const planetData of planetScreenData) {
                if (!planetData) continue;
                const distance = Math.sqrt(Math.pow(clickX - planetData.x, 2) + Math.pow(clickY - planetData.y, 2));
                const clickRadius = Math.max(planetData.radius, 10);
                
                if (distance <= clickRadius) {
                    clickedPlanetName = planetData.name;
                    
                    if (event.button === 2) {
                        showPlanetPopup(planetData, event.clientX, event.clientY);
                        return;
                    }
                    break;
                }
            }

            if (clickedPlanetName && event.button === 0) {
                showPlanetInfo(clickedPlanetName);
                audioManager.playClickSound();
            }
        }

        // åˆ‡æ¢æš‚åœ/æ’­æ”¾ - ä½¿ç”¨GSAP
        function togglePause() {
            paused = !paused;
            const btn = document.getElementById('pause-btn');
            
            if (paused) {
                btn.textContent = 'â–¶ï¸ æ’­æ”¾';
                gsap.to(canvas, { duration: 0.3, filter: 'grayscale(30%)' });
                createNotification('â¸ï¸ æ¨¡æ‹Ÿå·²æš‚åœ');
            } else {
                btn.textContent = 'â¸ï¸ æš‚åœ';
                gsap.to(canvas, { duration: 0.3, filter: glowEffectEnabled ? 'drop-shadow(0 0 20px rgba(255, 255, 255, 0.3))' : 'none' });
                createNotification('â–¶ï¸ æ¨¡æ‹Ÿå·²ç»§ç»­');
            }
            
            audioManager.playClickSound();
        }

        // åˆ‡æ¢æ ‡ç­¾æ˜¾ç¤º/éšè— - ä½¿ç”¨GSAP
        function toggleLabels(forceState = null) {
            showLabels = (forceState !== null) ? forceState : !showLabels;
            
            planetLabels.forEach(label => {
                if (label) {
                    gsap.to(label, { 
                        duration: 0.3, 
                        opacity: showLabels ? 1 : 0,
                        scale: showLabels ? 1 : 0.8,
                        ease: "back.out(1.7)"
                    });
                }
            });

            toggleLabelsBtn.textContent = showLabels ? 'ğŸ™ˆ éšè—æ ‡ç­¾' : 'ğŸ·ï¸ æ˜¾ç¤ºæ ‡ç­¾';
            createNotification(showLabels ? 'ğŸ·ï¸ æ ‡ç­¾å·²æ˜¾ç¤º' : 'ğŸ™ˆ æ ‡ç­¾å·²éšè—');
            audioManager.playClickSound();
        }

        // é‡ç½®æ¨¡æ‹ŸçŠ¶æ€
        function resetSimulation() {
            // GSAPé‡ç½®åŠ¨ç”»
            gsap.to(canvas, { 
                duration: 0.5, 
                rotation: 360, 
                scale: 0.8,
                ease: "power2.inOut",
                onComplete: () => {
                    gsap.set(canvas, { rotation: 0, scale: 1 });
                }
            });

            planets.forEach(planet => {
                planet.angle = Math.random() * Math.PI * 2;
                planet.rotationAngle = 0;
                planet.trail = [];
                if (planet.moons && Array.isArray(planet.moons)) {
                    planet.moons.forEach((moon, index) => {
                        moon.angle = (index * Math.PI / (planet.moons.length || 1));
                    });
                }
            });

            speed = 0.01;
            document.getElementById('speed-slider').value = speed;
            document.getElementById('speed-value').textContent = speed.toFixed(3) + 'x';

            adjustInitialZoomForMobile();
            paused = false;
            document.getElementById('pause-btn').textContent = 'â¸ï¸ æš‚åœ';

            showLabels = true;
            toggleLabels(true);

            planets.forEach(planet => {
                planet.showTrail = false;
            });
            toggleTrailsBtn.textContent = 'ğŸŒŸ æ˜¾ç¤ºè½¨è¿¹';

            if (showAsteroidBelt) {
                toggleAsteroidBelt();
            }

            showIntroContent();
            createLabels();
            settingsPopup.style.display = 'none';
            
            createNotification('ğŸ”„ æ¨¡æ‹Ÿå·²é‡ç½®');
            audioManager.playClickSound();
        }

        // æ›´æ–°æ¨¡æ‹Ÿé€Ÿåº¦
        function updateSpeed(event) {
            speed = parseFloat(event.target.value);
            document.getElementById('speed-value').textContent = speed.toFixed(3) + 'x';
            
            // é€Ÿåº¦å˜åŒ–åŠ¨ç”»
            gsap.fromTo(document.getElementById('speed-value'), 
                { scale: 1.2, color: '#64b5f6' }, 
                { duration: 0.3, scale: 1, color: '#64b5f6' }
            );
        }

        // æ›´æ–°è´¨é‡è®¾ç½®
        function updateQuality(event) {
            qualityMultiplier = parseFloat(event.target.value);
            document.getElementById('quality-value').textContent = qualityMultiplier.toFixed(1) + 'x';
            
            // é‡æ–°è°ƒæ•´ç”»å¸ƒå¤§å°ä»¥åº”ç”¨æ–°çš„è´¨é‡è®¾ç½®
            resizeCanvas();
            
            createNotification(`ğŸ¨ æ¸²æŸ“è´¨é‡: ${qualityMultiplier.toFixed(1)}x`);
        }

        // æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´åˆå§‹ç¼©æ”¾
        function adjustInitialZoomForMobile() {
            const isMobile = window.innerWidth <= 768;
            const isPortrait = window.innerHeight > window.innerWidth;

            if (isMobile) {
                if (isPortrait) {
                    zoom = 0.6;
                    offsetX = defaultOffsetX * 1.2;
                    offsetY = defaultOffsetY * 1.2;
                } else {
                    zoom = 0.8;
                    offsetX = defaultOffsetX;
                    offsetY = defaultOffsetY;
                }
            } else {
                zoom = 1.0;
                offsetX = defaultOffsetX;
                offsetY = defaultOffsetY;
            }

            centerX = baseX + offsetX;
            centerY = baseY + offsetY;
            updateZoomValueDisplay();
        }

        // åˆ‡æ¢è®¾ç½®å¼¹çª— - ä½¿ç”¨GSAP
        function toggleSettingsPopup() {
            const isVisible = settingsPopup.style.display === 'block';
            
            if (isVisible) {
                gsap.to(settingsPopup, {
                    duration: 0.3,
                    opacity: 0,
                    y: 20,
                    scale: 0.95,
                    ease: "back.in(1.7)",
                    onComplete: () => settingsPopup.style.display = 'none'
                });
            } else {
                settingsPopup.style.display = 'block';
                gsap.fromTo(settingsPopup,
                    { opacity: 0, y: 20, scale: 0.95 },
                    { duration: 0.3, opacity: 1, y: 0, scale: 1, ease: "back.out(1.7)" }
                );
            }
            
            audioManager.playClickSound();
        }

        // åˆå§‹åŒ–å‡½æ•°
        async function init() {
            // æ˜¾ç¤ºåŠ è½½å±å¹•
            gsap.to(loadingScreen, { duration: 0.5, opacity: 1 });

            try {
                // åˆå§‹åŒ–å„ä¸ªç³»ç»Ÿ
                audioManager.init();
                
                // è®¾ç½®ç”»å¸ƒåˆå§‹å¤§å°
                resizeCanvas();
                
                // ç”Ÿæˆå°è¡Œæ˜Ÿå¸¦
                generateAsteroidBelt();
                
                // åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ
                particleSystem = new ParticleSystem();
                
                // åˆ›å»ºè¡Œæ˜Ÿå¼¹å‡ºçª—å£
                createPlanetPopup();

                // è®¾ç½®æ§åˆ¶é¢æ¿åˆå§‹å€¼
                document.getElementById('speed-slider').value = speed;
                document.getElementById('speed-value').textContent = speed.toFixed(3) + 'x';
                document.getElementById('quality-slider').value = qualityMultiplier;
                document.getElementById('quality-value').textContent = qualityMultiplier.toFixed(1) + 'x';
                updateZoomValueDisplay();
                
                // æŒ‰é’®åˆå§‹æ–‡æœ¬
                document.getElementById('pause-btn').textContent = paused ? 'â–¶ï¸ æ’­æ”¾' : 'â¸ï¸ æš‚åœ';
                toggleLabelsBtn.textContent = showLabels ? 'ğŸ™ˆ éšè—æ ‡ç­¾' : 'ğŸ·ï¸ æ˜¾ç¤ºæ ‡ç­¾';
                toggleTrailsBtn.textContent = 'ğŸŒŸ æ˜¾ç¤ºè½¨è¿¹';
                infoToggleBtn.textContent = infoPanelVisible ? 'ğŸ“‹ éšè—ä¿¡æ¯' : 'ğŸ“‹ æ˜¾ç¤ºä¿¡æ¯';
                document.getElementById('toggle-asteroid-belt-btn').textContent = 'ğŸª¨ æ˜¾ç¤ºå°è¡Œæ˜Ÿå¸¦';
                document.getElementById('toggle-glow-btn').textContent = 'âœ¨ å‘å…‰æ•ˆæœ';

                if (!infoPanelVisible) infoPanel.classList.add('hidden');
                else showIntroContent();

                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                canvas.addEventListener('click', handleCanvasClick);
                canvas.addEventListener('contextmenu', (e) => e.preventDefault());
                
                // æŒ‰é’®äº‹ä»¶
                document.getElementById('pause-btn').addEventListener('click', togglePause);
                document.getElementById('reset-btn').addEventListener('click', resetSimulation);
                document.getElementById('fullscreen-btn').addEventListener('click', toggleFullscreen);
                document.getElementById('screenshot-btn').addEventListener('click', takeScreenshot);
                toggleLabelsBtn.addEventListener('click', () => toggleLabels());
                toggleTrailsBtn.addEventListener('click', toggleTrails);
                document.getElementById('toggle-glow-btn').addEventListener('click', toggleGlowEffect);
                document.getElementById('speed-slider').addEventListener('input', updateSpeed);
                document.getElementById('quality-slider').addEventListener('input', updateQuality);
                infoToggleBtn.addEventListener('click', toggleInfoPanel);
                document.getElementById('toggle-asteroid-belt-btn').addEventListener('click', toggleAsteroidBelt);
                settingsBtn.addEventListener('click', toggleSettingsPopup);
                settingsCloseBtn.addEventListener('click', toggleSettingsPopup);

                // è®¾ç½®äº¤äº’æ§åˆ¶
                setupInteractionControls();
                setupKeyboardControls();

                // æ›´æ–°åŸºç¡€ä¸­å¿ƒç‚¹
                baseX = canvas.width / 2;
                baseY = canvas.height / 2;
                offsetX = defaultOffsetX;
                offsetY = defaultOffsetY;
                centerX = baseX + offsetX;
                centerY = baseY + offsetY;

                // ä¸ºç§»åŠ¨è®¾å¤‡è°ƒæ•´åˆå§‹ç¼©æ”¾
                adjustInitialZoomForMobile();

                // æ¨¡æ‹ŸåŠ è½½æ—¶é—´
                await new Promise(resolve => setTimeout(resolve, 1000));

                // éšè—åŠ è½½å±å¹•
                gsap.to(loadingScreen, { 
                    duration: 0.5, 
                    opacity: 0, 
                    onComplete: () => {
                        loadingScreen.style.display = 'none';
                        
                        // å¯åŠ¨åŠ¨ç”»å¾ªç¯
                        requestAnimationFrame(draw);
                        
                        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                        createNotification('ğŸŒŒ æ¬¢è¿æ¥åˆ°å¤ªé˜³ç³»æ¨¡æ‹Ÿå™¨ï¼');
                    }
                });

            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                createNotification('âŒ åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>
